<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>matscipy.fracture_mechanics.crack API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.MPa_sqrt_m">MPa_sqrt_m</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.PLANE_STRAIN">PLANE_STRAIN</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.PLANE_STRESS">PLANE_STRESS</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.G_to_strain">G_to_strain</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.deformation_gradient_residual">deformation_gradient_residual</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.deformation_gradient_residuals">deformation_gradient_residuals</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.displacement_residual">displacement_residual</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.displacement_residuals">displacement_residuals</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.find_tip_coordination">find_tip_coordination</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.find_tip_stress_field">find_tip_stress_field</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.fit_crack_stress_field">fit_crack_stress_field</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.get_energy_release_rate">get_energy_release_rate</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.get_strain">get_strain</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.get_stress_intensity_factor">get_stress_intensity_factor</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_displacement_field">isotropic_modeI_crack_tip_displacement_field</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_stress_field">isotropic_modeI_crack_tip_stress_field</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.plot_stress_fields">plot_stress_fields</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.print_crack_system">print_crack_system</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.strain_to_G">strain_to_G</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.thin_strip_displacement_y">thin_strip_displacement_y</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#matscipy.fracture_mechanics.crack.ConstantStrainRate">ConstantStrainRate</a></span>
        
          
  <ul>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.ConstantStrainRate.__init__">__init__</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_forces">adjust_forces</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_positions">adjust_positions</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.ConstantStrainRate.copy">copy</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack">CubicCrystalCrack</a></span>
        
          
  <ul>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.__init__">__init__</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position">crack_tip_position</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position_y">crack_tip_position_y</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient">deformation_gradient</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cartesian_coordinates">deformation_gradient_from_cartesian_coordinates</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cylinder_coordinates">deformation_gradient_from_cylinder_coordinates</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements">displacements</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cartesian_coordinates">displacements_from_cartesian_coordinates</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cylinder_coordinates">displacements_from_cylinder_coordinates</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1g">k1g</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1gsqG">k1gsqG</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.scale_displacements">scale_displacements</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses">stresses</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cartesian_coordinates">stresses_from_cartesian_coordinates</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cylinder_coordinates">stresses_from_cylinder_coordinates</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#matscipy.fracture_mechanics.crack.IsotropicStressField">IsotropicStressField</a></span>
        
          
  <ul>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.IsotropicStressField.__init__">__init__</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.IsotropicStressField.get_stresses">get_stresses</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack">RectilinearAnisotropicCrack</a></span>
        
          
  <ul>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.__init__">__init__</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.deformation_gradient">deformation_gradient</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.displacements">displacements</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1g">k1g</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1gsqG">k1gsqG</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.rtheta">rtheta</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_strain">set_plane_strain</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_stress">set_plane_stress</a></li>
    <li class="mono"><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.stresses">stresses</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">matscipy.fracture_mechanics.crack</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack" class="source">
    <div class="codehilite"><pre><span class="c"># ======================================================================</span>
<span class="c"># matscipy - Python materials science tools</span>
<span class="c"># https://github.com/libAtoms/matscipy</span>
<span class="c">#</span>
<span class="c"># Copyright (2014) James Kermode, King&#39;s College London</span>
<span class="c">#                  Lars Pastewka, Karlsruhe Institute of Technology</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 2 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c"># ======================================================================</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">brentq</span><span class="p">,</span> <span class="n">leastsq</span><span class="p">,</span> <span class="n">minimize</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Warning: no scipy&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">ase.units</span> <span class="kn">as</span> <span class="nn">units</span>
<span class="kn">from</span> <span class="nn">ase.calculators.neighborlist</span> <span class="kn">import</span> <span class="n">NeighborList</span>    

<span class="kn">from</span> <span class="nn">matscipy.atomic_strain</span> <span class="kn">import</span> <span class="n">atomic_strain</span>
<span class="kn">from</span> <span class="nn">matscipy.elasticity</span> <span class="kn">import</span> <span class="p">(</span><span class="n">rotate_elastic_constants</span><span class="p">,</span>
                                 <span class="n">rotate_cubic_elastic_constants</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matscipy.surface</span> <span class="kn">import</span> <span class="n">MillerDirection</span><span class="p">,</span> <span class="n">MillerPlane</span>

<span class="c">###</span>

<span class="c"># Constants</span>
<span class="n">PLANE_STRAIN</span> <span class="o">=</span> <span class="s">&#39;plane strain&#39;</span>
<span class="n">PLANE_STRESS</span> <span class="o">=</span> <span class="s">&#39;plane stress&#39;</span>

<span class="n">MPa_sqrt_m</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">Pascal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

<span class="c">###</span>

<span class="k">class</span> <span class="nc">RectilinearAnisotropicCrack</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Near field solution for a crack in a rectilinear anisotropic elastic medium.</span>
<span class="sd">    See:</span>
<span class="sd">    G. C. Sih, P. C. Paris and G. R. Irwin, Int. J. Frac. Mech. 1, 189 (1965)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="nf">set_plane_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a11</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a16</span><span class="p">,</span> <span class="n">a26</span><span class="p">,</span> <span class="n">a66</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">a11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">a22</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="n">a12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="n">a16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="n">a26</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="n">a66</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_crack</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">set_plane_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b11</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">b33</span><span class="p">,</span> <span class="n">b12</span><span class="p">,</span> <span class="n">b13</span><span class="p">,</span> <span class="n">b23</span><span class="p">,</span> <span class="n">b16</span><span class="p">,</span> <span class="n">b26</span><span class="p">,</span> <span class="n">b36</span><span class="p">,</span> 
                         <span class="n">b66</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">b11</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b13</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">b22</span> <span class="o">-</span> <span class="p">(</span><span class="n">b23</span><span class="o">*</span><span class="n">b23</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="n">b12</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b23</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="n">b16</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b36</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="n">b26</span> <span class="o">-</span> <span class="p">(</span><span class="n">b23</span><span class="o">*</span><span class="n">b36</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="n">b66</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_crack</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_init_crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize dependent parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a16</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a12</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a66</span><span class="p">,</span>
                         <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a26</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="p">]</span> <span class="p">)</span>

        <span class="n">mu1</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">mu3</span><span class="p">,</span> <span class="n">mu4</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">r</span>

        <span class="k">if</span> <span class="n">mu1</span> <span class="o">!=</span> <span class="n">mu2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Roots not in pairs.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mu3</span> <span class="o">!=</span> <span class="n">mu4</span><span class="o">.</span><span class="n">conjugate</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Roots not in pairs.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">=</span> <span class="n">mu1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">=</span> <span class="n">mu3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a16</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a16</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a26</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q2</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a26</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span>


    <span class="k">def</span> <span class="nf">displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture. Positions are passed in cyclinder</span>
<span class="sd">        coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : array_like</span>
<span class="sd">            Distances from the crack tip.</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            Angles with respect to the plane of the crack.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        u : array</span>
<span class="sd">            Displacements parallel to the plane of the crack.</span>
<span class="sd">        v : array</span>
<span class="sd">            Displacements normal to the plane of the crack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span><span class="o">*</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span><span class="o">*</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span><span class="o">*</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span><span class="o">*</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>

        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>


    <span class="k">def</span> <span class="nf">deformation_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deformation gradient tensor in mode I fracture. Positions are passed in</span>
<span class="sd">        cyclinder coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : array_like</span>
<span class="sd">            Distances from the crack tip.</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            Angles with respect to the plane of the crack.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        du_dx : array</span>
<span class="sd">            Derivatives of displacements parallel to the plane within the plane.</span>
<span class="sd">        du_dy : array</span>
<span class="sd">            Derivatives of displacements parallel to the plane perpendicular to</span>
<span class="sd">            the plane.</span>
<span class="sd">        dv_dx : array</span>
<span class="sd">            Derivatives of displacements normal to the plane of the crack within</span>
<span class="sd">            the plane.</span>
<span class="sd">        dv_dy : array</span>
<span class="sd">            Derivatives of displacements normal to the plane of the crack </span>
<span class="sd">            perpendicular to the plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">du_dx</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">du_dy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>

        <span class="n">dv_dx</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">dv_dy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>

        <span class="c"># We need to add unity matrix to turn this into the deformation gradient</span>
        <span class="c"># tensor.</span>
        <span class="n">du_dx</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">du_dx</span><span class="p">)</span>
        <span class="n">dv_dy</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">dv_dy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([[</span><span class="n">du_dx</span><span class="p">,</span> <span class="n">du_dy</span><span class="p">],</span> <span class="p">[</span><span class="n">dv_dx</span><span class="p">,</span> <span class="n">dv_dy</span><span class="p">]])</span>


    <span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field in mode I fracture. Positions are passed in cylinder</span>
<span class="sd">        coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : array_like</span>
<span class="sd">            Distances from the crack tip.</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            Angles with respect to the plane of the crack.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sig_x : array</span>
<span class="sd">            Diagonal component of stress tensor parallel to the plane of the</span>
<span class="sd">            crack.</span>
<span class="sd">        sig_y : array</span>
<span class="sd">            Diagonal component of stress tensor normal to the plane of the</span>
<span class="sd">            crack.</span>
<span class="sd">        sig_xy : array</span>
<span class="sd">            Off-diagonal component of the stress tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">sig_x</span>  <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
        <span class="n">sig_y</span>  <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
        <span class="n">sig_xy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>

        <span class="k">return</span> <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span>


    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

        <span class="k">return</span> <span class="n">v</span> <span class="o">-</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span> \
            <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>


    <span class="k">def</span> <span class="nf">rtheta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invert displacement field in mode I fracture, i.e. compute r and theta</span>
<span class="sd">        from displacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># u/v = (self.mu1_p2*h2 - self.mu2_p1*h3)/(self.mu1_q2*h2-self.mu2_q1*h3)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">/</span><span class="n">v</span><span class="p">))</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

        <span class="n">sqrt_2_r</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">k</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">sqrt_2_r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">sqrt_2_r</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">k</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">sqrt_2_r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">r1</span><span class="o">+</span><span class="n">r2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">theta</span> <span class="p">)</span>


    <span class="k">def</span> <span class="nf">k1g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        K1G, Griffith critical stress intensity in mode I fracture</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">surface_energy</span> <span class="o">/</span> \
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">*</span>
                          <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">))</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">k1gsqG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">))</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>

<span class="c">###</span>

<span class="k">def</span> <span class="nf">displacement_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return actual displacement field minus ideal displacement field,</span>
<span class="sd">    divided by r**alpha.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">r0</span>
    <span class="n">u1x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">ref_x</span>
    <span class="n">u1y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ref_y</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
    <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">u2x</span><span class="p">,</span> <span class="n">u2y</span> <span class="o">=</span> <span class="n">crack</span><span class="o">.</span><span class="n">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">power</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
        <span class="n">power_of_abs_dr</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">power_of_abs_dr</span> <span class="o">=</span> <span class="n">abs_dr</span><span class="o">**</span><span class="n">power</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">u1x</span> <span class="o">-</span> <span class="n">u2x</span><span class="p">)</span><span class="o">/</span><span class="n">power_of_abs_dr</span><span class="p">,</span> <span class="p">(</span><span class="n">u1y</span> <span class="o">-</span> <span class="n">u2y</span><span class="p">)</span><span class="o">/</span><span class="n">power_of_abs_dr</span>


<span class="k">def</span> <span class="nf">displacement_residual</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">dux</span><span class="p">,</span> <span class="n">duy</span> <span class="o">=</span> <span class="n">displacement_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                      <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">dux</span><span class="p">,</span> <span class="n">duy</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">dux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">duy</span><span class="p">[</span><span class="n">mask</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">deformation_gradient_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                   <span class="n">cutoff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return actual displacement field minus ideal displacement field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">r0</span>

    <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]))</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ref</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]))</span>

    <span class="n">F1</span><span class="p">,</span> <span class="n">res1</span> <span class="o">=</span> <span class="n">atomic_strain</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">)</span>
    <span class="c"># F1 is a 3x3 tensor, we throw away all z-components</span>
    <span class="p">[</span><span class="n">F1xx</span><span class="p">,</span> <span class="n">F1yx</span><span class="p">,</span> <span class="n">F1zx</span><span class="p">],</span> <span class="p">[</span><span class="n">F1xy</span><span class="p">,</span> <span class="n">F1yy</span><span class="p">,</span> <span class="n">F1zy</span><span class="p">],</span> <span class="p">[</span><span class="n">F1xz</span><span class="p">,</span> <span class="n">F1yz</span><span class="p">,</span> <span class="n">F1zz</span><span class="p">]</span> <span class="o">=</span> <span class="n">F1</span><span class="o">.</span><span class="n">T</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">F1xx</span><span class="p">,</span> <span class="n">F1xy</span><span class="p">],</span> <span class="p">[</span><span class="n">F1yx</span><span class="p">,</span> <span class="n">F1yy</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>

    <span class="n">F2</span> <span class="o">=</span> <span class="n">crack</span><span class="o">.</span><span class="n">deformation_gradient</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">F1</span><span class="o">-</span><span class="n">F2</span>


<span class="k">def</span> <span class="nf">deformation_gradient_residual</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                  <span class="n">cutoff</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">dF</span> <span class="o">=</span> <span class="n">deformation_gradient_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span>
                                        <span class="n">k</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dF</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#return (dF[mask]*dF[mask]).sum(axis=2).sum(axis=1)</span>
        <span class="k">return</span> <span class="n">dF</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c">###</span>

<span class="k">class</span> <span class="nc">CubicCrystalCrack</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crack in a cubic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">,</span> <span class="n">C11</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">C12</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">C44</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Crot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a crack in a cubic crystal with elastic constants C11, C12</span>
<span class="sd">        and C44 (or optionally a full 6x6 elastic constant matrix C).</span>
<span class="sd">        The crack surface is given by crack_surface, the cracks runs</span>
<span class="sd">        in the plane given by crack_front.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># x (third_dir) - direction in which the crack is running</span>
        <span class="c"># y (crack_surface) - free surface that forms due to the crack</span>
        <span class="c"># z (crack_front) - direction of the crack front</span>
        <span class="n">third_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">)</span>
        <span class="n">third_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">third_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">third_dir</span><span class="p">,</span>
                                                         <span class="n">third_dir</span><span class="p">))</span>
        <span class="n">crack_surface</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">)</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">))</span>
        <span class="n">crack_front</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">crack_front</span><span class="p">)</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">crack_front</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">))</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">third_dir</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">third_dir</span> <span class="o">=</span> <span class="o">-</span><span class="n">third_dir</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">third_dir</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">Crot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">C6</span> <span class="o">=</span> <span class="n">Crot</span>
        <span class="k">elif</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">C6</span> <span class="o">=</span> <span class="n">rotate_elastic_constants</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">C6</span> <span class="o">=</span> <span class="n">rotate_cubic_elastic_constants</span><span class="p">(</span><span class="n">C11</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="n">C44</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crack</span> <span class="o">=</span> <span class="n">RectilinearAnisotropicCrack</span><span class="p">()</span>
        <span class="n">S6</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">C6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S6</span>

        <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">set_plane_stress</span><span class="p">(</span><span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">set_plane_strain</span><span class="p">(</span><span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">k1g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Griffith critical stress intensity in mode I fracture.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        surface_energy : float</span>
<span class="sd">            Surface energy of the respective crystal surface.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        k1g : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">k1g</span><span class="p">(</span><span class="n">surface_energy</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">k1gsqG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">k1gsqG</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cylindrical coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">displacements</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">displacements_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field for a list of cartesian positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ux : array_like</span>
<span class="sd">            x-displacements.</span>
<span class="sd">        uy : array_like</span>
<span class="sd">            y-displacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">deformation_gradient_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cylindrical coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">deformation_gradient</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">deformation_gradient_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deformation_gradient_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">deformation_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deformation gradient for a list of cartesian positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ux : array_like</span>
<span class="sd">            x-displacements.</span>
<span class="sd">        uy : array_like</span>
<span class="sd">            y-displacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deformation_gradient_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">crack_tip_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">residual_func</span><span class="o">=</span><span class="n">displacement_residual</span><span class="p">,</span>
                           <span class="n">method</span><span class="o">=</span><span class="s">&#39;Powell&#39;</span><span class="p">,</span> <span class="n">return_residuals</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an estimate of the real crack tip position by minimizing the </span>
<span class="sd">        mean square error of the current configuration relative to the</span>
<span class="sd">        diplacement field obtained for a stress intensity factor k from linear</span>
<span class="sd">        elastic fracture mechanics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            y-positions of the atomic system containing the crack.</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            Initial guess for the x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            Initial guess for the y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        mask : array_like, optional</span>
<span class="sd">            Marks the atoms to use for this calculation.</span>
<span class="sd">        residual_func : function</span>
<span class="sd">            Function returning per-atom residuals to be minimized.</span>
<span class="sd">        method : str</span>
<span class="sd">            Optimization method. See method argument of scipy.optimize.minimize.</span>
<span class="sd">            Additionally, &#39;leastsq&#39; invokes scipy.optimize.leastsq.</span>
<span class="sd">        return_residuals : bool</span>
<span class="sd">            Function returns residuals if set to True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        residuals : array, optional</span>
<span class="sd">            Per-atom residuals at end of optimization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;leastsq&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">residual_func</span><span class="p">,</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">(</span><span class="n">residual_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                           <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span>
                           <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip. Reason: {}&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">return_residuals</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">residual_func</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>


    <span class="k">def</span> <span class="nf">_residual_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="n">dux</span><span class="p">,</span> <span class="n">duy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">dux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">+</span><span class="n">duy</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">duy</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">crack_tip_position_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an estimate of the y-coordinate of the real crack tip position </span>
<span class="sd">        assuming the stress intensity factor is k.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            y-positions of the atomic system containing the crack.</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            Initial guess for the x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            Initial guess for the y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        mask : array_like, optional</span>
<span class="sd">            Marks the atoms to use for this calculation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="p">(</span> <span class="n">y0</span><span class="p">,</span> <span class="p">),</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_residual_y</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y0</span>


    <span class="k">def</span> <span class="nf">scale_displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">old_k</span><span class="p">,</span> <span class="n">new_k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rescale atomic positions from stress intensity factor old_k to the new</span>
<span class="sd">        stress intensity factor new_k. This is useful for extrapolation of </span>
<span class="sd">        relaxed positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            y-positions of the atomic system containing the crack.</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        old_k : float</span>
<span class="sd">            Current stress intensity factor.</span>
<span class="sd">        new_k : float</span>
<span class="sd">            Stress intensity factor for the output positions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            New x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            New y-positions of the atomic system containing the crack.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ref_x</span> <span class="o">+</span> <span class="n">new_k</span><span class="o">/</span><span class="n">old_k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">ref_x</span><span class="p">),</span> <span class="n">ref_y</span> <span class="o">+</span> <span class="n">new_k</span><span class="o">/</span><span class="n">old_k</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">ref_y</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stresses_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field in mode I fracture from cylindrical coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">stresses</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stresses_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field in mode I fracture from cartesian coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field for a list of cartesian positions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sig_x : array_like</span>
<span class="sd">            xx-component of the stress tensor</span>

<span class="sd">        sig_y : array_like</span>
<span class="sd">            yy-component of the stress tensor</span>

<span class="sd">        sig_xy : array_like</span>
<span class="sd">            xy-component of the stress tensor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span>



<span class="k">def</span> <span class="nf">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">xy_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                           <span class="n">nu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Irwin singular crack tip stress field for mode I fracture.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    K : float</span>
<span class="sd">       Mode I stress intensity factor. Units should match units of `r`.</span>
<span class="sd">    r : array_like</span>
<span class="sd">       Radial distances from crack tip. Can be a multidimensional</span>
<span class="sd">       array to evaluate stress field on a grid.</span>
<span class="sd">    t : array_like</span>
<span class="sd">       Angles from horzontal line y=0 ahead of crack tip,</span>
<span class="sd">       measured anticlockwise. Should have same shape as `r`.</span>
<span class="sd">    xy_only : bool</span>
<span class="sd">       If True (default) only xx, yy, xy and yx components will be set.</span>
<span class="sd">    nu : float</span>
<span class="sd">       Poisson ratio. Used only when ``xy_only=False``, to determine zz stresses</span>
<span class="sd">    stress_state : str</span>
<span class="sd">       One of&quot;plane stress&quot; or &quot;plane strain&quot;. Used if xyz_only=False to</span>
<span class="sd">       determine zz stresses.</span>
<span class="sd">       </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sigma : array with shape ``r.shape + (3,3)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Shapes of radial and angular arrays &quot;r&quot; and &quot;t&quot; &#39;</span>
                         <span class="s">&#39;must match.&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">stress_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&quot;stress_state&quot; should be either &quot;{0}&quot; or &quot;{1}&quot;.&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">))</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">radial</span> <span class="o">=</span> <span class="n">K</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="c"># xx</span>
    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="c"># yy</span>
    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>         <span class="c"># xy</span>
    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>                                               <span class="c"># yx=xy</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xy_only</span> <span class="ow">and</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>              <span class="c"># zz</span>

    <span class="k">return</span> <span class="n">sigma</span>
    
    
<span class="k">def</span> <span class="nf">isotropic_modeI_crack_tip_displacement_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span>
                                                 <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Irwin singular crack tip displacement field for mode I fracture.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    K : float</span>
<span class="sd">        Mode I stress intensity factor. Units should match units of `G` and `r`.</span>
<span class="sd">    G : float</span>
<span class="sd">        Shear modulus. Units should match units of `K` and `r`.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Poisson ratio.</span>
<span class="sd">    r : array_like</span>
<span class="sd">        Radial distances from crack tip. Can be a multidimensional</span>
<span class="sd">        array to evaluate stress field on a grid.</span>
<span class="sd">    t : array_like</span>
<span class="sd">        Angles from horizontal line y=0 ahead of crack tip,</span>
<span class="sd">        measured anticlockwise. Should have same shape as `r`.</span>
<span class="sd">    stress_state : str</span>
<span class="sd">        One of&quot;plane stress&quot; or &quot;plane strain&quot;. Used if xyz_only=False to</span>
<span class="sd">        determine zz stresses.</span>
<span class="sd">       </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : array</span>
<span class="sd">    v : array</span>
<span class="sd">        Displacements. Same shape as `r` and `t`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Shapes of radial and angular arrays &quot;r&quot; and &quot;t&quot; &#39;</span>
                         <span class="s">&#39;must match.&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="mi">3</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">nu</span>
    <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span><span class="o">-</span><span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">nu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&quot;stress_state&quot; should be either &quot;{0}&quot; or &quot;{1}&quot;.&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">))</span>

    <span class="n">radial</span> <span class="o">=</span> <span class="n">K</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c"># Form in Lawn book is equivalent:</span>
    <span class="c">#radial = K/(4*G)*np.sqrt(r/(2.*math.pi))</span>
    <span class="c">#u = radial*((2*kappa - 1)*np.cos(t/2) - np.cos(3*t/2))</span>
    <span class="c">#v = radial*((2*kappa + 1)*np.sin(t/2) - np.sin(3*t/2))</span>

    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>


<span class="k">class</span> <span class="nc">IsotropicStressField</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculator to return Irwin near-tip stress field at atomic sites</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sxx0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">syy0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sxy0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">stress_state</span><span class="o">=</span><span class="s">&#39;plane strain&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sxx0</span> <span class="o">=</span> <span class="n">sxx0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syy0</span> <span class="o">=</span> <span class="n">syy0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span> <span class="o">=</span> <span class="n">sxy0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress_state</span> <span class="o">=</span> <span class="n">stress_state</span>

    <span class="k">def</span> <span class="nf">get_stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span>
        <span class="k">if</span> <span class="n">K</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y0</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
        
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">stress_state</span><span class="p">)</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxx0</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">syy0</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span>

        <span class="k">return</span> <span class="n">sigma</span>
    

<span class="k">def</span> <span class="nf">strain_to_G</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from strain to energy release rate G for thin strip geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    strain : float</span>
<span class="sd">       Dimensionless ratio ``(current_height - orig_height)/orig_height``</span>
<span class="sd">    E : float</span>
<span class="sd">       Young&#39;s modulus relevant for a pull in y direction sigma_yy/eps_yy</span>
<span class="sd">    nu : float</span>
<span class="sd">       Poission ratio -eps_yy/eps_xx</span>
<span class="sd">    orig_height : float</span>
<span class="sd">       Unstrained height of slab</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    G : float</span>
<span class="sd">       Energy release rate in units consistent with input</span>
<span class="sd">       (i.e. in eV/A**2 if eV/A/fs units used)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">orig_height</span>


<span class="k">def</span> <span class="nf">G_to_strain</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from energy release rate G to strain for thin strip geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    G : float</span>
<span class="sd">       Energy release rate in units consistent with `E` and `orig_height`</span>
<span class="sd">    E : float</span>
<span class="sd">       Young&#39;s modulus relevant for a pull in y direction sigma_yy/eps_yy</span>
<span class="sd">    nu : float</span>
<span class="sd">       Poission ratio -eps_yy/eps_xx</span>
<span class="sd">    orig_height : float</span>
<span class="sd">       Unstrained height of slab</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    strain : float</span>
<span class="sd">       Dimensionless ratio ``(current_height - orig_height)/orig_height``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">orig_height</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_strain</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the current strain on thin strip configuration `atoms`</span>

<span class="sd">    Requires unstrained height of slab to be stored as ``OrigHeight``</span>
<span class="sd">    key in ``atoms.info`` dictionary.</span>

<span class="sd">    Also updates value stored in ``atoms.info``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">orig_height</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;OrigHeight&#39;</span><span class="p">]</span>
    <span class="n">current_height</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">current_height</span> <span class="o">/</span> <span class="n">orig_height</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;strain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strain</span>
    <span class="k">return</span> <span class="n">strain</span>


<span class="k">def</span> <span class="nf">get_energy_release_rate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the current energy release rate G for `atoms`</span>

<span class="sd">    Result is computed assuming thin strip geometry, and using</span>
<span class="sd">    stored Young&#39;s modulus and Poission ratio and original slab height</span>
<span class="sd">    from `atoms.info` dictionary.</span>

<span class="sd">    Also updates `G` value stored in ``atoms.info`` dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">current_strain</span> <span class="o">=</span> <span class="n">get_strain</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">orig_height</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;OrigHeight&#39;</span><span class="p">]</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;YoungsModulus&#39;</span><span class="p">]</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;PoissonRatio_yx&#39;</span><span class="p">]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">strain_to_G</span><span class="p">(</span><span class="n">current_strain</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span>
    <span class="k">return</span> <span class="n">G</span>


<span class="k">def</span> <span class="nf">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute stress intensity factor K_I</span>

<span class="sd">    Calls :func:`get_energy_release_rate` to compute `G`, then</span>
<span class="sd">    uses stored `YoungsModulus` and `PoissionRatio_yz` values from</span>
<span class="sd">    `atoms.info` dictionary to compute K_I.</span>

<span class="sd">    Also updates value stored in ``atoms.info`` dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">get_energy_release_rate</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;YoungsModulus&#39;</span><span class="p">]</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;PoissonRatio_yx&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="n">Ep</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
        <span class="n">Ep</span> <span class="o">=</span> <span class="n">E</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&quot;stress_state&quot; should be either &quot;{0}&quot; or &quot;{1}&quot;.&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">))</span>
                         
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">Ep</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span>
    <span class="k">return</span> <span class="n">K</span>


<span class="k">def</span> <span class="nf">fit_crack_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">),</span> <span class="n">initial_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fix_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_decay</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">calc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a least squares fit of near-tip stress field to isotropic solution</span>

<span class="sd">    Stresses on the atoms are fit to the Irwin K-field singular crack tip</span>
<span class="sd">    solution, allowing the crack position, stress intensity factor and</span>
<span class="sd">    far-field stress components to vary during the fit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : :class:`~.Atoms` object</span>
<span class="sd">       Crack system. For the initial fit, the following keys are used</span>
<span class="sd">       from the :attr:`~Atoms.info` dictionary:</span>

<span class="sd">          - ``YoungsModulus``</span>
<span class="sd">          - ``PossionRatio_yx``</span>
<span class="sd">          - ``G`` --- current energy release rate</span>
<span class="sd">          - ``strain`` --- current applied strain</span>
<span class="sd">          - ``CrackPos`` --- initial guess for crack tip position</span>

<span class="sd">       The initial guesses for the stress intensity factor ``K`` and</span>
<span class="sd">       far-field stress ``sigma0`` are computed from</span>
<span class="sd">       ``YoungsModulus``, ``PoissonRatio_yx``, ``G`` and ``strain``,</span>
<span class="sd">       assuming plane strain in thin strip boundary conditions.</span>

<span class="sd">       On exit, new ``K``, ``sigma0`` and ``CrackPos`` entries are set</span>
<span class="sd">       in the :attr:`~Atoms.info` dictionary. These values are then</span>
<span class="sd">       used as starting guesses for subsequent fits.</span>

<span class="sd">    r_range : sequence of two floats, optional</span>
<span class="sd">       If present, restrict the stress fit to an annular region</span>
<span class="sd">       ``r_range[0] &lt;= r &lt; r_range[1]``, centred on the previous crack</span>
<span class="sd">       position (from the ``CrackPos`` entry in ``atoms.info``). If</span>
<span class="sd">       r_range is ``None``, fit is carried out for all atoms.</span>

<span class="sd">    initial_params : dict</span>
<span class="sd">       Names and initial values of parameters. Missing initial values</span>
<span class="sd">       are guessed from Atoms object.</span>

<span class="sd">    fix_params : dict</span>
<span class="sd">       Names and values of parameters to fix during the fit,</span>
<span class="sd">       e.g. ``{y0: 0.0}`` to constrain the fit to the line y=0</span>

<span class="sd">    sigma : None or array with shape (len(atoms), 3, 3)</span>
<span class="sd">       Explicitly provide the per-atom stresses. Avoids calling Atoms&#39;</span>
<span class="sd">       calculators :meth:`~.get_stresses` method.</span>

<span class="sd">    avg_sigma : None or array with shape (len(atoms), 3, 3)</span>
<span class="sd">       If present, use this array to accumulate the time-averaged</span>
<span class="sd">       stress field. Useful when processing a trajectory.</span>

<span class="sd">    avg_decay : real</span>
<span class="sd">       Factor by which average stress is attenuated at each step.</span>
<span class="sd">       Should be set to ``dt/tau`` where ``dt`` is MD time-step</span>
<span class="sd">       and ``tau`` is a characteristic averaging time.</span>

<span class="sd">    calc : Calculator object, optional</span>
<span class="sd">       If present, override the calculator used to compute stresses</span>
<span class="sd">       on the atoms. Default is ``atoms.get_calculator``.</span>

<span class="sd">       To use the atom resolved stress tensor pass an instance of the </span>
<span class="sd">       :class:`~quippy.elasticity.AtomResolvedStressField` class.</span>

<span class="sd">    verbose : bool, optional</span>
<span class="sd">       If set to True, print additional information about the fit.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params : dict with keys ``[K, x0, y0, sxx0, syy0, sxy0]``</span>
<span class="sd">       Fitted parameters, in a form suitable for passing to</span>
<span class="sd">       :class:`IsotropicStressField` constructor. These are the stress intensity</span>
<span class="sd">       factor `K`, the centre of the stress field ``(x0, y0)``, and the</span>
<span class="sd">       far field contribution to the stress ``(sxx0, syy0, sxy0)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">initial_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;K&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
       <span class="c"># Guess for stress intensity factor K</span>
       <span class="k">if</span> <span class="s">&#39;K&#39;</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="k">try</span><span class="p">:</span>
               <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
           <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
               <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">MPa_sqrt_m</span>

    <span class="k">if</span> <span class="s">&#39;sxx0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s">&#39;syy0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s">&#39;sxy0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
       <span class="c"># Guess for far-field stress</span>
       <span class="k">if</span> <span class="s">&#39;sigma0&#39;</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
          <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;sigma0&#39;</span><span class="p">]</span>
       <span class="k">else</span><span class="p">:</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">E</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;YoungsModulus&#39;</span><span class="p">]</span>
              <span class="n">nu</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;PoissonRatio_yx&#39;</span><span class="p">]</span>
              <span class="n">Ep</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ep</span><span class="o">*</span><span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;strain&#39;</span><span class="p">]</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
          <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="s">&#39;x0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s">&#39;y0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
       <span class="c"># Guess for crack position</span>
       <span class="k">try</span><span class="p">:</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">]</span>
       <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span>
                           <span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c"># Override any fixed parameters</span>
    <span class="k">if</span> <span class="n">fix_params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">fix_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fix_params</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c"># Get local stresses</span>
    <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">calc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
           <span class="n">calc</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_calculator</span><span class="p">()</span>
       <span class="n">sigma</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">get_stresses</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c"># Update avg_sigma in place</span>
    <span class="k">if</span> <span class="n">avg_sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">avg_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">avg_decay</span><span class="p">)</span><span class="o">*</span><span class="n">avg_sigma</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">avg_decay</span><span class="p">))</span><span class="o">*</span><span class="n">sigma</span>
       <span class="n">sigma</span> <span class="o">=</span> <span class="n">avg_sigma</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c"># Zero components out of the xy plane</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span> <span class="c"># all atoms</span>
    <span class="k">if</span> <span class="n">r_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span> <span class="o">=</span> <span class="n">r_range</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">rmax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;Fitting on </span><span class="si">%r</span><span class="s"> atoms&#39;</span> <span class="o">%</span> <span class="n">sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">objective_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">var_params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fix_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fix_params</span><span class="p">)</span>
        <span class="n">isotropic_sigma</span> <span class="o">=</span> <span class="n">IsotropicStressField</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">get_stresses</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">delta_sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,:,:]</span> <span class="o">-</span> <span class="n">isotropic_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,:,:]</span>
        <span class="k">return</span> <span class="n">delta_sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">delta_sigma</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="c"># names and values of parameters which can vary in this fit</span>
    <span class="n">var_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fix_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">])</span>
    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_params</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>
    <span class="n">fitted_params</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">objective_function</span><span class="p">,</span>
                                                         <span class="n">initial_params</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">var_params</span><span class="p">),</span>
                                                         <span class="n">full_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="n">fitted_params</span><span class="p">))</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fix_params</span><span class="p">)</span>

    <span class="c"># estimate variance in parameter estimates</span>
    <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="c"># singular covariance matrix</span>
       <span class="n">err</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">s_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">objective_function</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">var_params</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">))</span>
       <span class="n">cov</span> <span class="o">=</span> <span class="n">cov</span> <span class="o">*</span> <span class="n">s_sq</span>
       <span class="n">err</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cov</span><span class="p">))))</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;K = </span><span class="si">%.3f</span><span class="s"> MPa sqrt(m)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">MPA_SQRT_M</span><span class="p">))</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;sigma^0_{xx,yy,xy} = (</span><span class="si">%.1f</span><span class="s">, </span><span class="si">%.1f</span><span class="s">, </span><span class="si">%.1f</span><span class="s">) GPa&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span>
                                                              <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span>
                                                              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">))</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack position (x0, y0) = (</span><span class="si">%.1f</span><span class="s">, </span><span class="si">%.1f</span><span class="s">) A&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">]))</span>

    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;sigma0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">err</span>


<span class="k">def</span> <span class="nf">find_tip_coordination</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">bondlength</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span> <span class="n">bulk_nn</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find position of tip in crack cluster from coordination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nl</span> <span class="o">=</span> <span class="n">NeighborList</span><span class="p">([</span><span class="n">bondlength</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                      <span class="n">skin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                      <span class="n">self_interaction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">bothways</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">nl</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">nl</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))])</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">&#39;n_neighb&#39;</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s">&#39;groups&#39;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">above</span> <span class="o">=</span> <span class="p">(</span><span class="n">nn</span> <span class="o">&lt;</span> <span class="n">bulk_nn</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">below</span> <span class="o">=</span> <span class="p">(</span><span class="n">nn</span> <span class="o">&lt;</span> <span class="n">bulk_nn</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">&#39;above&#39;</span><span class="p">,</span> <span class="n">above</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">&#39;below&#39;</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>

    <span class="n">bond1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">above</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">above</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()])</span>
    <span class="n">bond2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">below</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">below</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()])</span>

    <span class="c"># These need to be ints, otherwise they are no JSON serializable.</span>
    <span class="n">a</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;bond1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond1</span>
    <span class="n">a</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;bond2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond2</span>

    <span class="k">return</span> <span class="n">bond1</span><span class="p">,</span> <span class="n">bond2</span>
    

<span class="k">def</span> <span class="nf">find_tip_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fix_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_decay</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">calc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the position of crack tip by fitting to the isotropic `K`-field stress</span>

<span class="sd">    Fit is carried out using :func:`fit_crack_stress_field`, and parameters</span>
<span class="sd">    have the same meaning as there.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    fit_crack_stress_field</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_crack_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="p">,</span> <span class="n">initial_params</span><span class="p">,</span> <span class="n">fix_params</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span>
                                         <span class="n">avg_sigma</span><span class="p">,</span> <span class="n">avg_decay</span><span class="p">,</span> <span class="n">calc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
    

<span class="k">def</span> <span class="nf">plot_stress_fields</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fix_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_decay</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">calc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit and plot atomistic and continuum stress fields</span>

<span class="sd">    Firstly a fit to the Irwin `K`-field solution is carried out using</span>
<span class="sd">    :func:`fit_crack_stress_field`, and parameters have the same</span>
<span class="sd">    meaning as for that function. Then plots of the</span>
<span class="sd">    :math:`\sigma_{xx}`, :math:`\sigma_{yy}`, :math:`\sigma_{xy}`</span>
<span class="sd">    fields are produced for atomistic and continuum cases, and for the</span>
<span class="sd">    residual error after fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">griddata</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span> <span class="n">subplot</span><span class="p">,</span> <span class="n">cla</span><span class="p">,</span> <span class="n">contourf</span><span class="p">,</span> <span class="n">colorbar</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">clf</span><span class="p">,</span> <span class="n">gca</span>

    <span class="n">params</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_crack_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="p">,</span> <span class="n">initial_params</span><span class="p">,</span> <span class="n">fix_params</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span>
                                         <span class="n">avg_sigma</span><span class="p">,</span> <span class="n">avg_decay</span><span class="p">,</span> <span class="n">calc</span><span class="p">)</span>

    <span class="n">K</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">sxx0</span><span class="p">,</span> <span class="n">syy0</span><span class="p">,</span> <span class="n">sxy0</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span>
                                   <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">])</span>
   
    <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span> <span class="o">=</span> <span class="n">r_range</span>
       <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">rmax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span>

    <span class="n">atom_sigma</span> <span class="o">=</span> <span class="n">sigma</span>
    <span class="k">if</span> <span class="n">atom_sigma</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">atom_sigma</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_stresses</span><span class="p">()</span>

    <span class="n">grid_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">atom_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span>
                            <span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">atom_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span>
                            <span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">atom_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)])</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

    <span class="n">grid_sigma</span><span class="p">[((</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">)),:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c"># mask outside fitting region</span>

    <span class="n">isotropic_sigma</span> <span class="o">=</span> <span class="n">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sxx0</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">syy0</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sxy0</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sxy0</span>
    <span class="n">isotropic_sigma</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">isotropic_sigma</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">grid_sigma</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>

    <span class="n">isotropic_sigma</span><span class="p">[((</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">)),:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c"># mask outside fitting region</span>

    <span class="n">contours</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>

    <span class="n">dcontours</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>

    <span class="n">clf</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">),</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                  <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span>
                                  <span class="p">[</span><span class="s">&#39;\sigma_{xx}&#39;</span><span class="p">,</span> <span class="s">r&#39;\sigma_{yy}&#39;</span><span class="p">,</span> <span class="s">r&#39;\sigma_{xy}&#39;</span><span class="p">]):</span>
        <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">grid_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">colorbar</span><span class="p">()</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$</span><span class="si">%s</span><span class="s">^\mathrm{atom}$&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">draw</span><span class="p">()</span>

        <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">colorbar</span><span class="p">()</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$</span><span class="si">%s</span><span class="s">^\mathrm{Isotropic}$&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">draw</span><span class="p">()</span>

        <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">grid_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
                           <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span> <span class="n">dcontours</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">colorbar</span><span class="p">()</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|</span><span class="si">%s</span><span class="s">^\mathrm{atom} - </span><span class="si">%s</span><span class="s">^\mathrm{isotropic}|$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
        <span class="n">draw</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">thin_strip_displacement_y</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">strain</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return vertical displacement ramp used to apply initial strain to slab</span>

<span class="sd">    Strain is increased from 0 to strain over distance :math:`a &lt;= x &lt;= b`.</span>
<span class="sd">    Region :math:`x &lt; a` is rigidly shifted up/down by ``strain*height/2``.</span>

<span class="sd">    Here is an example of how to use this function on an artificial</span>
<span class="sd">    2D square atomic lattice. The positions are plotted before (left)</span>
<span class="sd">    and after (right) applying the displacement, and the horizontal and</span>
<span class="sd">    vertical lines show the `strain` (red), `a` (green) and `b` (blue)</span>
<span class="sd">    parameters. ::</span>

<span class="sd">       import matplotlib.pyplot as plt</span>
<span class="sd">       import numpy as np</span>

<span class="sd">       w = 1; h = 1; strain = 0.1; a = -0.5; b =  0.0</span>
<span class="sd">       x = np.linspace(-w, w, 20)</span>
<span class="sd">       y = np.linspace(-h, h, 20)</span>
<span class="sd">       X, Y = np.meshgrid(x, y)</span>
<span class="sd">       u_y = thin_strip_displacement_y(X, Y, strain, a, b)</span>

<span class="sd">       for i, disp in enumerate([0, u_y]):</span>
<span class="sd">           plt.subplot(1,2,i+1)</span>
<span class="sd">           plt.scatter(X, Y + disp, c=&#39;k&#39;, s=5)</span>
<span class="sd">           for y in [-h, h]:</span>
<span class="sd">               plt.axhline(y, color=&#39;r&#39;, linewidth=2, linestyle=&#39;dashed&#39;)</span>
<span class="sd">               plt.axhline(y*(1+strain), color=&#39;r&#39;, linewidth=2)</span>
<span class="sd">           for x, c in zip([a, b], [&#39;g&#39;, &#39;b&#39;]):</span>
<span class="sd">               plt.axvline(x, color=c, linewidth=2)</span>

<span class="sd">    .. image:: thin-strip-displacement-y.png</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">    y : array</span>
<span class="sd">       Atomic positions in unstrained slab, centered on origin x=0,y=0</span>
<span class="sd">    strain : float</span>
<span class="sd">       Far field strain to apply</span>
<span class="sd">    a : float</span>
<span class="sd">       x coordinate for beginning of strain ramp</span>
<span class="sd">    b : float</span>
<span class="sd">       x coordinate for end of strain ramp</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">u_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>     <span class="c"># measure height of slab</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span>  <span class="c"># far behind crack, shift = strain*height/2</span>

    <span class="n">u_y</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">])</span> <span class="o">*</span> <span class="n">shift</span>  <span class="c"># region shift for x &lt; a</span>
    <span class="n">u_y</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">]</span>          <span class="c"># constant strain for x &gt; b</span>
    
    <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span>            <span class="c"># interpolate for a &lt;= x &lt;= b</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">u_y</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">shift</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">middle</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">u_y</span>


<span class="k">def</span> <span class="nf">print_crack_system</span><span class="p">(</span><span class="n">directions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty printing of crack crystallographic coordinate system </span>

<span class="sd">    Specified by list of Miller indices for crack_direction (x),</span>
<span class="sd">    cleavage_plane (y) and crack_front (z), each of which should be</span>
<span class="sd">    a sequence of three floats</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">crack_direction</span><span class="p">,</span> <span class="n">cleavage_plane</span><span class="p">,</span> <span class="n">crack_front</span> <span class="o">=</span> <span class="n">directions</span>
    
    <span class="n">crack_direction</span> <span class="o">=</span> <span class="n">MillerDirection</span><span class="p">(</span><span class="n">crack_direction</span><span class="p">)</span>
    <span class="n">cleavage_plane</span> <span class="o">=</span> <span class="n">MillerPlane</span><span class="p">(</span><span class="n">cleavage_plane</span><span class="p">)</span>
    <span class="n">crack_front</span> <span class="o">=</span> <span class="n">MillerDirection</span><span class="p">(</span><span class="n">crack_front</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack system              </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cleavage_plane</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack direction (x-axis)  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">crack_direction</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Cleavage plane  (y-axis)  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cleavage_plane</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack front     (z-axis)  </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">crack_front</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">ConstantStrainRate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constraint which increments epsilon_yy at a constant strain rate</span>

<span class="sd">    Rescaling is applied only to atoms where `mask` is True (default is all atoms)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">,</span> <span class="n">delta_strain</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span> <span class="o">=</span> <span class="n">orig_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span> <span class="o">=</span> <span class="n">delta_strain</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

    <span class="k">def</span> <span class="nf">adjust_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">forces</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">adjust_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldpos</span><span class="p">,</span> <span class="n">newpos</span><span class="p">):</span>
        <span class="n">current_height</span> <span class="o">=</span> <span class="n">newpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">newpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">current_strain</span> <span class="o">=</span> <span class="n">current_height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span> <span class="o">-</span> <span class="mf">1.0</span>
        <span class="n">new_strain</span> <span class="o">=</span> <span class="n">current_strain</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">new_strain</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">current_strain</span><span class="p">)</span>
        <span class="n">newpos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">newpos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">alpha</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ConstantStrainRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>



    
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.MPa_sqrt_m" class="name">var <span class="ident">MPa_sqrt_m</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.PLANE_STRAIN" class="name">var <span class="ident">PLANE_STRAIN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.PLANE_STRESS" class="name">var <span class="ident">PLANE_STRESS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.G_to_strain">
    <p>def <span class="ident">G_to_strain</span>(</p><p>G, E, nu, orig_height)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert from energy release rate G to strain for thin strip geometry</p>
<h2>Parameters</h2>
<p>G : float
   Energy release rate in units consistent with <code>E</code> and <code>orig_height</code>
E : float
   Young's modulus relevant for a pull in y direction sigma_yy/eps_yy
nu : float
   Poission ratio -eps_yy/eps_xx
orig_height : float
   Unstrained height of slab</p>
<h2>Returns</h2>
<p>strain : float
   Dimensionless ratio <code>(current_height - orig_height)/orig_height</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.G_to_strain', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.G_to_strain" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">G_to_strain</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from energy release rate G to strain for thin strip geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    G : float</span>
<span class="sd">       Energy release rate in units consistent with `E` and `orig_height`</span>
<span class="sd">    E : float</span>
<span class="sd">       Young&#39;s modulus relevant for a pull in y direction sigma_yy/eps_yy</span>
<span class="sd">    nu : float</span>
<span class="sd">       Poission ratio -eps_yy/eps_xx</span>
<span class="sd">    orig_height : float</span>
<span class="sd">       Unstrained height of slab</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    strain : float</span>
<span class="sd">       Dimensionless ratio ``(current_height - orig_height)/orig_height``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">orig_height</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.deformation_gradient_residual">
    <p>def <span class="ident">deformation_gradient_residual</span>(</p><p>r0, crack, x, y, cur, ref_x, ref_y, ref, k, cutoff, mask=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.deformation_gradient_residual', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.deformation_gradient_residual" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">deformation_gradient_residual</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                  <span class="n">cutoff</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">dF</span> <span class="o">=</span> <span class="n">deformation_gradient_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span>
                                        <span class="n">k</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dF</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#return (dF[mask]*dF[mask]).sum(axis=2).sum(axis=1)</span>
        <span class="k">return</span> <span class="n">dF</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.deformation_gradient_residuals">
    <p>def <span class="ident">deformation_gradient_residuals</span>(</p><p>r0, crack, x, y, cur, ref_x, ref_y, ref, k, cutoff)</p>
    </div>
    

    
  
    <div class="desc"><p>Return actual displacement field minus ideal displacement field.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.deformation_gradient_residuals', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.deformation_gradient_residuals" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">deformation_gradient_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                   <span class="n">cutoff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return actual displacement field minus ideal displacement field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">r0</span>

    <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cur</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]))</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ref</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]))</span>

    <span class="n">F1</span><span class="p">,</span> <span class="n">res1</span> <span class="o">=</span> <span class="n">atomic_strain</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">)</span>
    <span class="c"># F1 is a 3x3 tensor, we throw away all z-components</span>
    <span class="p">[</span><span class="n">F1xx</span><span class="p">,</span> <span class="n">F1yx</span><span class="p">,</span> <span class="n">F1zx</span><span class="p">],</span> <span class="p">[</span><span class="n">F1xy</span><span class="p">,</span> <span class="n">F1yy</span><span class="p">,</span> <span class="n">F1zy</span><span class="p">],</span> <span class="p">[</span><span class="n">F1xz</span><span class="p">,</span> <span class="n">F1yz</span><span class="p">,</span> <span class="n">F1zz</span><span class="p">]</span> <span class="o">=</span> <span class="n">F1</span><span class="o">.</span><span class="n">T</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">F1xx</span><span class="p">,</span> <span class="n">F1xy</span><span class="p">],</span> <span class="p">[</span><span class="n">F1yx</span><span class="p">,</span> <span class="n">F1yy</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>

    <span class="n">F2</span> <span class="o">=</span> <span class="n">crack</span><span class="o">.</span><span class="n">deformation_gradient</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">F1</span><span class="o">-</span><span class="n">F2</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.displacement_residual">
    <p>def <span class="ident">displacement_residual</span>(</p><p>r0, crack, x, y, ref_x, ref_y, k, mask=None, power=1)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.displacement_residual', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.displacement_residual" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">displacement_residual</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">dux</span><span class="p">,</span> <span class="n">duy</span> <span class="o">=</span> <span class="n">displacement_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                                      <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">dux</span><span class="p">,</span> <span class="n">duy</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">dux</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">duy</span><span class="p">[</span><span class="n">mask</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.displacement_residuals">
    <p>def <span class="ident">displacement_residuals</span>(</p><p>r0, crack, x, y, ref_x, ref_y, k, power=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Return actual displacement field minus ideal displacement field,
divided by r**alpha.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.displacement_residuals', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.displacement_residuals" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">displacement_residuals</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">crack</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return actual displacement field minus ideal displacement field,</span>
<span class="sd">    divided by r**alpha.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">r0</span>
    <span class="n">u1x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">ref_x</span>
    <span class="n">u1y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">ref_y</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
    <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">u2x</span><span class="p">,</span> <span class="n">u2y</span> <span class="o">=</span> <span class="n">crack</span><span class="o">.</span><span class="n">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">power</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
        <span class="n">power_of_abs_dr</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">power_of_abs_dr</span> <span class="o">=</span> <span class="n">abs_dr</span><span class="o">**</span><span class="n">power</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">u1x</span> <span class="o">-</span> <span class="n">u2x</span><span class="p">)</span><span class="o">/</span><span class="n">power_of_abs_dr</span><span class="p">,</span> <span class="p">(</span><span class="n">u1y</span> <span class="o">-</span> <span class="n">u2y</span><span class="p">)</span><span class="o">/</span><span class="n">power_of_abs_dr</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.find_tip_coordination">
    <p>def <span class="ident">find_tip_coordination</span>(</p><p>a, bondlength=2.6, bulk_nn=4)</p>
    </div>
    

    
  
    <div class="desc"><p>Find position of tip in crack cluster from coordination</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.find_tip_coordination', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.find_tip_coordination" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">find_tip_coordination</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">bondlength</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span> <span class="n">bulk_nn</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find position of tip in crack cluster from coordination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nl</span> <span class="o">=</span> <span class="n">NeighborList</span><span class="p">([</span><span class="n">bondlength</span><span class="o">/</span><span class="mf">2.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                      <span class="n">skin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                      <span class="n">self_interaction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">bothways</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">nl</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">nl</span><span class="o">.</span><span class="n">get_neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))])</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">&#39;n_neighb&#39;</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s">&#39;groups&#39;</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">above</span> <span class="o">=</span> <span class="p">(</span><span class="n">nn</span> <span class="o">&lt;</span> <span class="n">bulk_nn</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">below</span> <span class="o">=</span> <span class="p">(</span><span class="n">nn</span> <span class="o">&lt;</span> <span class="n">bulk_nn</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">&#39;above&#39;</span><span class="p">,</span> <span class="n">above</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">&#39;below&#39;</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>

    <span class="n">bond1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">above</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">above</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()])</span>
    <span class="n">bond2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">below</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">below</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()])</span>

    <span class="c"># These need to be ints, otherwise they are no JSON serializable.</span>
    <span class="n">a</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;bond1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond1</span>
    <span class="n">a</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;bond2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bond2</span>

    <span class="k">return</span> <span class="n">bond1</span><span class="p">,</span> <span class="n">bond2</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.find_tip_stress_field">
    <p>def <span class="ident">find_tip_stress_field</span>(</p><p>atoms, r_range=None, initial_params=None, fix_params=None, sigma=None, avg_sigma=None, avg_decay=0.005, calc=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Find the position of crack tip by fitting to the isotropic <code>K</code>-field stress</p>
<p>Fit is carried out using :func:<code>fit_crack_stress_field</code>, and parameters
have the same meaning as there.</p>
<h2>See also</h2>
<p>fit_crack_stress_field</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.find_tip_stress_field', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.find_tip_stress_field" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">find_tip_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fix_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_decay</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">calc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the position of crack tip by fitting to the isotropic `K`-field stress</span>

<span class="sd">    Fit is carried out using :func:`fit_crack_stress_field`, and parameters</span>
<span class="sd">    have the same meaning as there.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    fit_crack_stress_field</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_crack_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="p">,</span> <span class="n">initial_params</span><span class="p">,</span> <span class="n">fix_params</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span>
                                         <span class="n">avg_sigma</span><span class="p">,</span> <span class="n">avg_decay</span><span class="p">,</span> <span class="n">calc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.fit_crack_stress_field">
    <p>def <span class="ident">fit_crack_stress_field</span>(</p><p>atoms, r_range=(0.0, 50.0), initial_params=None, fix_params=None, sigma=None, avg_sigma=None, avg_decay=0.005, calc=None, verbose=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Perform a least squares fit of near-tip stress field to isotropic solution</p>
<p>Stresses on the atoms are fit to the Irwin K-field singular crack tip
solution, allowing the crack position, stress intensity factor and
far-field stress components to vary during the fit.</p>
<h2>Parameters</h2>
<p>atoms : :class:<code>~.Atoms</code> object
   Crack system. For the initial fit, the following keys are used
   from the :attr:<code>~Atoms.info</code> dictionary:</p>
<div class="codehilite"><pre>  <span class="o">-</span> <span class="err">``</span><span class="n">YoungsModulus</span><span class="err">``</span>
  <span class="o">-</span> <span class="err">``</span><span class="n">PossionRatio_yx</span><span class="err">``</span>
  <span class="o">-</span> <span class="err">``</span><span class="n">G</span><span class="err">``</span> <span class="o">---</span> <span class="n">current</span> <span class="n">energy</span> <span class="n">release</span> <span class="n">rate</span>
  <span class="o">-</span> <span class="err">``</span><span class="n">strain</span><span class="err">``</span> <span class="o">---</span> <span class="n">current</span> <span class="n">applied</span> <span class="n">strain</span>
  <span class="o">-</span> <span class="err">``</span><span class="n">CrackPos</span><span class="err">``</span> <span class="o">---</span> <span class="n">initial</span> <span class="n">guess</span> <span class="k">for</span> <span class="n">crack</span> <span class="n">tip</span> <span class="n">position</span>
</pre></div>


<p>The initial guesses for the stress intensity factor <code>K</code> and
   far-field stress <code>sigma0</code> are computed from
   <code>YoungsModulus</code>, <code>PoissonRatio_yx</code>, <code>G</code> and <code>strain</code>,
   assuming plane strain in thin strip boundary conditions.</p>
<p>On exit, new <code>K</code>, <code>sigma0</code> and <code>CrackPos</code> entries are set
   in the :attr:<code>~Atoms.info</code> dictionary. These values are then
   used as starting guesses for subsequent fits.</p>
<p>r_range : sequence of two floats, optional
   If present, restrict the stress fit to an annular region
   <code>r_range[0] &lt;= r &lt; r_range[1]</code>, centred on the previous crack
   position (from the <code>CrackPos</code> entry in <code>atoms.info</code>). If
   r_range is <code>None</code>, fit is carried out for all atoms.</p>
<p>initial_params : dict
   Names and initial values of parameters. Missing initial values
   are guessed from Atoms object.</p>
<p>fix_params : dict
   Names and values of parameters to fix during the fit,
   e.g. <code>{y0: 0.0}</code> to constrain the fit to the line y=0</p>
<p>sigma : None or array with shape (len(atoms), 3, 3)
   Explicitly provide the per-atom stresses. Avoids calling Atoms'
   calculators :meth:<code>~.get_stresses</code> method.</p>
<p>avg_sigma : None or array with shape (len(atoms), 3, 3)
   If present, use this array to accumulate the time-averaged
   stress field. Useful when processing a trajectory.</p>
<p>avg_decay : real
   Factor by which average stress is attenuated at each step.
   Should be set to <code>dt/tau</code> where <code>dt</code> is MD time-step
   and <code>tau</code> is a characteristic averaging time.</p>
<p>calc : Calculator object, optional
   If present, override the calculator used to compute stresses
   on the atoms. Default is <code>atoms.get_calculator</code>.</p>
<p>To use the atom resolved stress tensor pass an instance of the 
   :class:<code>~quippy.elasticity.AtomResolvedStressField</code> class.</p>
<p>verbose : bool, optional
   If set to True, print additional information about the fit.</p>
<h2>Returns</h2>
<p>params : dict with keys <code>[K, x0, y0, sxx0, syy0, sxy0]</code>
   Fitted parameters, in a form suitable for passing to
   :class:<code>IsotropicStressField</code> constructor. These are the stress intensity
   factor <code>K</code>, the centre of the stress field <code>(x0, y0)</code>, and the
   far field contribution to the stress <code>(sxx0, syy0, sxy0)</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.fit_crack_stress_field', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.fit_crack_stress_field" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">fit_crack_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">),</span> <span class="n">initial_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fix_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_decay</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">calc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a least squares fit of near-tip stress field to isotropic solution</span>

<span class="sd">    Stresses on the atoms are fit to the Irwin K-field singular crack tip</span>
<span class="sd">    solution, allowing the crack position, stress intensity factor and</span>
<span class="sd">    far-field stress components to vary during the fit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : :class:`~.Atoms` object</span>
<span class="sd">       Crack system. For the initial fit, the following keys are used</span>
<span class="sd">       from the :attr:`~Atoms.info` dictionary:</span>

<span class="sd">          - ``YoungsModulus``</span>
<span class="sd">          - ``PossionRatio_yx``</span>
<span class="sd">          - ``G`` --- current energy release rate</span>
<span class="sd">          - ``strain`` --- current applied strain</span>
<span class="sd">          - ``CrackPos`` --- initial guess for crack tip position</span>

<span class="sd">       The initial guesses for the stress intensity factor ``K`` and</span>
<span class="sd">       far-field stress ``sigma0`` are computed from</span>
<span class="sd">       ``YoungsModulus``, ``PoissonRatio_yx``, ``G`` and ``strain``,</span>
<span class="sd">       assuming plane strain in thin strip boundary conditions.</span>

<span class="sd">       On exit, new ``K``, ``sigma0`` and ``CrackPos`` entries are set</span>
<span class="sd">       in the :attr:`~Atoms.info` dictionary. These values are then</span>
<span class="sd">       used as starting guesses for subsequent fits.</span>

<span class="sd">    r_range : sequence of two floats, optional</span>
<span class="sd">       If present, restrict the stress fit to an annular region</span>
<span class="sd">       ``r_range[0] &lt;= r &lt; r_range[1]``, centred on the previous crack</span>
<span class="sd">       position (from the ``CrackPos`` entry in ``atoms.info``). If</span>
<span class="sd">       r_range is ``None``, fit is carried out for all atoms.</span>

<span class="sd">    initial_params : dict</span>
<span class="sd">       Names and initial values of parameters. Missing initial values</span>
<span class="sd">       are guessed from Atoms object.</span>

<span class="sd">    fix_params : dict</span>
<span class="sd">       Names and values of parameters to fix during the fit,</span>
<span class="sd">       e.g. ``{y0: 0.0}`` to constrain the fit to the line y=0</span>

<span class="sd">    sigma : None or array with shape (len(atoms), 3, 3)</span>
<span class="sd">       Explicitly provide the per-atom stresses. Avoids calling Atoms&#39;</span>
<span class="sd">       calculators :meth:`~.get_stresses` method.</span>

<span class="sd">    avg_sigma : None or array with shape (len(atoms), 3, 3)</span>
<span class="sd">       If present, use this array to accumulate the time-averaged</span>
<span class="sd">       stress field. Useful when processing a trajectory.</span>

<span class="sd">    avg_decay : real</span>
<span class="sd">       Factor by which average stress is attenuated at each step.</span>
<span class="sd">       Should be set to ``dt/tau`` where ``dt`` is MD time-step</span>
<span class="sd">       and ``tau`` is a characteristic averaging time.</span>

<span class="sd">    calc : Calculator object, optional</span>
<span class="sd">       If present, override the calculator used to compute stresses</span>
<span class="sd">       on the atoms. Default is ``atoms.get_calculator``.</span>

<span class="sd">       To use the atom resolved stress tensor pass an instance of the </span>
<span class="sd">       :class:`~quippy.elasticity.AtomResolvedStressField` class.</span>

<span class="sd">    verbose : bool, optional</span>
<span class="sd">       If set to True, print additional information about the fit.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params : dict with keys ``[K, x0, y0, sxx0, syy0, sxy0]``</span>
<span class="sd">       Fitted parameters, in a form suitable for passing to</span>
<span class="sd">       :class:`IsotropicStressField` constructor. These are the stress intensity</span>
<span class="sd">       factor `K`, the centre of the stress field ``(x0, y0)``, and the</span>
<span class="sd">       far field contribution to the stress ``(sxx0, syy0, sxy0)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">initial_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">initial_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;K&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
       <span class="c"># Guess for stress intensity factor K</span>
       <span class="k">if</span> <span class="s">&#39;K&#39;</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span>
       <span class="k">else</span><span class="p">:</span>
           <span class="k">try</span><span class="p">:</span>
               <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
           <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
               <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">MPa_sqrt_m</span>

    <span class="k">if</span> <span class="s">&#39;sxx0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s">&#39;syy0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s">&#39;sxy0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
       <span class="c"># Guess for far-field stress</span>
       <span class="k">if</span> <span class="s">&#39;sigma0&#39;</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
          <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;sigma0&#39;</span><span class="p">]</span>
       <span class="k">else</span><span class="p">:</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">E</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;YoungsModulus&#39;</span><span class="p">]</span>
              <span class="n">nu</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;PoissonRatio_yx&#39;</span><span class="p">]</span>
              <span class="n">Ep</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ep</span><span class="o">*</span><span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;strain&#39;</span><span class="p">]</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span><span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
          <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="s">&#39;x0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s">&#39;y0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
       <span class="c"># Guess for crack position</span>
       <span class="k">try</span><span class="p">:</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">]</span>
       <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span>
                           <span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>
           <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c"># Override any fixed parameters</span>
    <span class="k">if</span> <span class="n">fix_params</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">fix_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fix_params</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c"># Get local stresses</span>
    <span class="k">if</span> <span class="n">sigma</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">calc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
           <span class="n">calc</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_calculator</span><span class="p">()</span>
       <span class="n">sigma</span> <span class="o">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">get_stresses</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c"># Update avg_sigma in place</span>
    <span class="k">if</span> <span class="n">avg_sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">avg_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">avg_decay</span><span class="p">)</span><span class="o">*</span><span class="n">avg_sigma</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">avg_decay</span><span class="p">))</span><span class="o">*</span><span class="n">sigma</span>
       <span class="n">sigma</span> <span class="o">=</span> <span class="n">avg_sigma</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c"># Zero components out of the xy plane</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span> <span class="c"># all atoms</span>
    <span class="k">if</span> <span class="n">r_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span> <span class="o">=</span> <span class="n">r_range</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">rmax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;Fitting on </span><span class="si">%r</span><span class="s"> atoms&#39;</span> <span class="o">%</span> <span class="n">sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">objective_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">var_params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fix_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fix_params</span><span class="p">)</span>
        <span class="n">isotropic_sigma</span> <span class="o">=</span> <span class="n">IsotropicStressField</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">get_stresses</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">delta_sigma</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,:,:]</span> <span class="o">-</span> <span class="n">isotropic_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,:,:]</span>
        <span class="k">return</span> <span class="n">delta_sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">delta_sigma</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="c"># names and values of parameters which can vary in this fit</span>
    <span class="n">var_params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fix_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">])</span>
    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">var_params</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>
    <span class="n">fitted_params</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">objective_function</span><span class="p">,</span>
                                                         <span class="n">initial_params</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">var_params</span><span class="p">),</span>
                                                         <span class="n">full_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="n">fitted_params</span><span class="p">))</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fix_params</span><span class="p">)</span>

    <span class="c"># estimate variance in parameter estimates</span>
    <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="c"># singular covariance matrix</span>
       <span class="n">err</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">s_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">objective_function</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">var_params</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fitted_params</span><span class="p">))</span>
       <span class="n">cov</span> <span class="o">=</span> <span class="n">cov</span> <span class="o">*</span> <span class="n">s_sq</span>
       <span class="n">err</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_params</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cov</span><span class="p">))))</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;K = </span><span class="si">%.3f</span><span class="s"> MPa sqrt(m)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">MPA_SQRT_M</span><span class="p">))</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;sigma^0_{xx,yy,xy} = (</span><span class="si">%.1f</span><span class="s">, </span><span class="si">%.1f</span><span class="s">, </span><span class="si">%.1f</span><span class="s">) GPa&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span>
                                                              <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span>
                                                              <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">))</span>
       <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack position (x0, y0) = (</span><span class="si">%.1f</span><span class="s">, </span><span class="si">%.1f</span><span class="s">) A&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">]))</span>

    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;sigma0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">])</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">err</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.get_energy_release_rate">
    <p>def <span class="ident">get_energy_release_rate</span>(</p><p>atoms)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the current energy release rate G for <code>atoms</code></p>
<p>Result is computed assuming thin strip geometry, and using
stored Young's modulus and Poission ratio and original slab height
from <code>atoms.info</code> dictionary.</p>
<p>Also updates <code>G</code> value stored in <code>atoms.info</code> dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.get_energy_release_rate', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.get_energy_release_rate" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_energy_release_rate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the current energy release rate G for `atoms`</span>

<span class="sd">    Result is computed assuming thin strip geometry, and using</span>
<span class="sd">    stored Young&#39;s modulus and Poission ratio and original slab height</span>
<span class="sd">    from `atoms.info` dictionary.</span>

<span class="sd">    Also updates `G` value stored in ``atoms.info`` dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">current_strain</span> <span class="o">=</span> <span class="n">get_strain</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">orig_height</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;OrigHeight&#39;</span><span class="p">]</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;YoungsModulus&#39;</span><span class="p">]</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;PoissonRatio_yx&#39;</span><span class="p">]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">strain_to_G</span><span class="p">(</span><span class="n">current_strain</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span>
    <span class="k">return</span> <span class="n">G</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.get_strain">
    <p>def <span class="ident">get_strain</span>(</p><p>atoms)</p>
    </div>
    

    
  
    <div class="desc"><p>Return the current strain on thin strip configuration <code>atoms</code></p>
<p>Requires unstrained height of slab to be stored as <code>OrigHeight</code>
key in <code>atoms.info</code> dictionary.</p>
<p>Also updates value stored in <code>atoms.info</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.get_strain', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.get_strain" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_strain</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the current strain on thin strip configuration `atoms`</span>

<span class="sd">    Requires unstrained height of slab to be stored as ``OrigHeight``</span>
<span class="sd">    key in ``atoms.info`` dictionary.</span>

<span class="sd">    Also updates value stored in ``atoms.info``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">orig_height</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;OrigHeight&#39;</span><span class="p">]</span>
    <span class="n">current_height</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">strain</span> <span class="o">=</span> <span class="n">current_height</span> <span class="o">/</span> <span class="n">orig_height</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;strain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strain</span>
    <span class="k">return</span> <span class="n">strain</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.get_stress_intensity_factor">
    <p>def <span class="ident">get_stress_intensity_factor</span>(</p><p>atoms, stress_state=&#39;plane strain&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute stress intensity factor K_I</p>
<p>Calls :func:<code>get_energy_release_rate</code> to compute <code>G</code>, then
uses stored <code>YoungsModulus</code> and <code>PoissionRatio_yz</code> values from
<code>atoms.info</code> dictionary to compute K_I.</p>
<p>Also updates value stored in <code>atoms.info</code> dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.get_stress_intensity_factor', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.get_stress_intensity_factor" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute stress intensity factor K_I</span>

<span class="sd">    Calls :func:`get_energy_release_rate` to compute `G`, then</span>
<span class="sd">    uses stored `YoungsModulus` and `PoissionRatio_yz` values from</span>
<span class="sd">    `atoms.info` dictionary to compute K_I.</span>

<span class="sd">    Also updates value stored in ``atoms.info`` dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">get_energy_release_rate</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;YoungsModulus&#39;</span><span class="p">]</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;PoissonRatio_yx&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="n">Ep</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
        <span class="n">Ep</span> <span class="o">=</span> <span class="n">E</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&quot;stress_state&quot; should be either &quot;{0}&quot; or &quot;{1}&quot;.&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">))</span>
                         
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">Ep</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span>
    <span class="k">return</span> <span class="n">K</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_displacement_field">
    <p>def <span class="ident">isotropic_modeI_crack_tip_displacement_field</span>(</p><p>K, G, nu, r, t, stress_state=&#39;plane strain&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute Irwin singular crack tip displacement field for mode I fracture.</p>
<h2>Parameters</h2>
<p>K : float
    Mode I stress intensity factor. Units should match units of <code>G</code> and <code>r</code>.
G : float
    Shear modulus. Units should match units of <code>K</code> and <code>r</code>.
nu : float
    Poisson ratio.
r : array_like
    Radial distances from crack tip. Can be a multidimensional
    array to evaluate stress field on a grid.
t : array_like
    Angles from horizontal line y=0 ahead of crack tip,
    measured anticlockwise. Should have same shape as <code>r</code>.
stress_state : str
    One of"plane stress" or "plane strain". Used if xyz_only=False to
    determine zz stresses.</p>
<h2>Returns</h2>
<p>u : array
v : array
    Displacements. Same shape as <code>r</code> and <code>t</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_displacement_field', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_displacement_field" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">isotropic_modeI_crack_tip_displacement_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span>
                                                 <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Irwin singular crack tip displacement field for mode I fracture.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    K : float</span>
<span class="sd">        Mode I stress intensity factor. Units should match units of `G` and `r`.</span>
<span class="sd">    G : float</span>
<span class="sd">        Shear modulus. Units should match units of `K` and `r`.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Poisson ratio.</span>
<span class="sd">    r : array_like</span>
<span class="sd">        Radial distances from crack tip. Can be a multidimensional</span>
<span class="sd">        array to evaluate stress field on a grid.</span>
<span class="sd">    t : array_like</span>
<span class="sd">        Angles from horizontal line y=0 ahead of crack tip,</span>
<span class="sd">        measured anticlockwise. Should have same shape as `r`.</span>
<span class="sd">    stress_state : str</span>
<span class="sd">        One of&quot;plane stress&quot; or &quot;plane strain&quot;. Used if xyz_only=False to</span>
<span class="sd">        determine zz stresses.</span>
<span class="sd">       </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : array</span>
<span class="sd">    v : array</span>
<span class="sd">        Displacements. Same shape as `r` and `t`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Shapes of radial and angular arrays &quot;r&quot; and &quot;t&quot; &#39;</span>
                         <span class="s">&#39;must match.&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="mi">3</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">nu</span>
    <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span><span class="o">-</span><span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">nu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&quot;stress_state&quot; should be either &quot;{0}&quot; or &quot;{1}&quot;.&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">))</span>

    <span class="n">radial</span> <span class="o">=</span> <span class="n">K</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">G</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c"># Form in Lawn book is equivalent:</span>
    <span class="c">#radial = K/(4*G)*np.sqrt(r/(2.*math.pi))</span>
    <span class="c">#u = radial*((2*kappa - 1)*np.cos(t/2) - np.cos(3*t/2))</span>
    <span class="c">#v = radial*((2*kappa + 1)*np.sin(t/2) - np.sin(3*t/2))</span>

    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_stress_field">
    <p>def <span class="ident">isotropic_modeI_crack_tip_stress_field</span>(</p><p>K, r, t, xy_only=True, nu=0.5, stress_state=&#39;plane strain&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute Irwin singular crack tip stress field for mode I fracture.</p>
<h2>Parameters</h2>
<p>K : float
   Mode I stress intensity factor. Units should match units of <code>r</code>.
r : array_like
   Radial distances from crack tip. Can be a multidimensional
   array to evaluate stress field on a grid.
t : array_like
   Angles from horzontal line y=0 ahead of crack tip,
   measured anticlockwise. Should have same shape as <code>r</code>.
xy_only : bool
   If True (default) only xx, yy, xy and yx components will be set.
nu : float
   Poisson ratio. Used only when <code>xy_only=False</code>, to determine zz stresses
stress_state : str
   One of"plane stress" or "plane strain". Used if xyz_only=False to
   determine zz stresses.</p>
<h2>Returns</h2>
<p>sigma : array with shape <code>r.shape + (3,3)</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_stress_field', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.isotropic_modeI_crack_tip_stress_field" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">xy_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                           <span class="n">nu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Irwin singular crack tip stress field for mode I fracture.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    K : float</span>
<span class="sd">       Mode I stress intensity factor. Units should match units of `r`.</span>
<span class="sd">    r : array_like</span>
<span class="sd">       Radial distances from crack tip. Can be a multidimensional</span>
<span class="sd">       array to evaluate stress field on a grid.</span>
<span class="sd">    t : array_like</span>
<span class="sd">       Angles from horzontal line y=0 ahead of crack tip,</span>
<span class="sd">       measured anticlockwise. Should have same shape as `r`.</span>
<span class="sd">    xy_only : bool</span>
<span class="sd">       If True (default) only xx, yy, xy and yx components will be set.</span>
<span class="sd">    nu : float</span>
<span class="sd">       Poisson ratio. Used only when ``xy_only=False``, to determine zz stresses</span>
<span class="sd">    stress_state : str</span>
<span class="sd">       One of&quot;plane stress&quot; or &quot;plane strain&quot;. Used if xyz_only=False to</span>
<span class="sd">       determine zz stresses.</span>
<span class="sd">       </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sigma : array with shape ``r.shape + (3,3)``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Shapes of radial and angular arrays &quot;r&quot; and &quot;t&quot; &#39;</span>
                         <span class="s">&#39;must match.&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">stress_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&quot;stress_state&quot; should be either &quot;{0}&quot; or &quot;{1}&quot;.&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">PLANE_STRESS</span><span class="p">))</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">radial</span> <span class="o">=</span> <span class="n">K</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="c"># xx</span>
    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span> <span class="c"># yy</span>
    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">radial</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>         <span class="c"># xy</span>
    <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>                                               <span class="c"># yx=xy</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">xy_only</span> <span class="ow">and</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>              <span class="c"># zz</span>

    <span class="k">return</span> <span class="n">sigma</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.plot_stress_fields">
    <p>def <span class="ident">plot_stress_fields</span>(</p><p>atoms, r_range=None, initial_params=None, fix_params=None, sigma=None, avg_sigma=None, avg_decay=0.005, calc=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Fit and plot atomistic and continuum stress fields</p>
<p>Firstly a fit to the Irwin <code>K</code>-field solution is carried out using
:func:<code>fit_crack_stress_field</code>, and parameters have the same
meaning as for that function. Then plots of the
:math:<code>\sigma_{xx}</code>, :math:<code>\sigma_{yy}</code>, :math:<code>\sigma_{xy}</code>
fields are produced for atomistic and continuum cases, and for the
residual error after fitting.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.plot_stress_fields', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.plot_stress_fields" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">plot_stress_fields</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fix_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_sigma</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg_decay</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">calc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit and plot atomistic and continuum stress fields</span>

<span class="sd">    Firstly a fit to the Irwin `K`-field solution is carried out using</span>
<span class="sd">    :func:`fit_crack_stress_field`, and parameters have the same</span>
<span class="sd">    meaning as for that function. Then plots of the</span>
<span class="sd">    :math:`\sigma_{xx}`, :math:`\sigma_{yy}`, :math:`\sigma_{xy}`</span>
<span class="sd">    fields are produced for atomistic and continuum cases, and for the</span>
<span class="sd">    residual error after fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">griddata</span><span class="p">,</span> <span class="n">meshgrid</span><span class="p">,</span> <span class="n">subplot</span><span class="p">,</span> <span class="n">cla</span><span class="p">,</span> <span class="n">contourf</span><span class="p">,</span> <span class="n">colorbar</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">clf</span><span class="p">,</span> <span class="n">gca</span>

    <span class="n">params</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">fit_crack_stress_field</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">r_range</span><span class="p">,</span> <span class="n">initial_params</span><span class="p">,</span> <span class="n">fix_params</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span>
                                         <span class="n">avg_sigma</span><span class="p">,</span> <span class="n">avg_decay</span><span class="p">,</span> <span class="n">calc</span><span class="p">)</span>

    <span class="n">K</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">sxx0</span><span class="p">,</span> <span class="n">syy0</span><span class="p">,</span> <span class="n">sxy0</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;K&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;x0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;y0&#39;</span><span class="p">],</span>
                                   <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxx0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;syy0&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;sxy0&#39;</span><span class="p">])</span>
   
    <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span> <span class="o">=</span> <span class="n">r_range</span>
       <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">rmax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span>

    <span class="n">atom_sigma</span> <span class="o">=</span> <span class="n">sigma</span>
    <span class="k">if</span> <span class="n">atom_sigma</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">atom_sigma</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_stresses</span><span class="p">()</span>

    <span class="n">grid_sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">atom_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span>
                            <span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">atom_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span>
                            <span class="n">griddata</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">-</span><span class="n">y0</span><span class="p">,</span> <span class="n">atom_sigma</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)])</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>

    <span class="n">grid_sigma</span><span class="p">[((</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">)),:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c"># mask outside fitting region</span>

    <span class="n">isotropic_sigma</span> <span class="o">=</span> <span class="n">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sxx0</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">syy0</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sxy0</span>
    <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sxy0</span>
    <span class="n">isotropic_sigma</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">isotropic_sigma</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">grid_sigma</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>

    <span class="n">isotropic_sigma</span><span class="p">[((</span><span class="n">R</span> <span class="o">&lt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">)),:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c"># mask outside fitting region</span>

    <span class="n">contours</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>

    <span class="n">dcontours</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>

    <span class="n">clf</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">),</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                  <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span>
                                  <span class="p">[</span><span class="s">&#39;\sigma_{xx}&#39;</span><span class="p">,</span> <span class="s">r&#39;\sigma_{yy}&#39;</span><span class="p">,</span> <span class="s">r&#39;\sigma_{xy}&#39;</span><span class="p">]):</span>
        <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">grid_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">colorbar</span><span class="p">()</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$</span><span class="si">%s</span><span class="s">^\mathrm{atom}$&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">draw</span><span class="p">()</span>

        <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span> <span class="n">contours</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">colorbar</span><span class="p">()</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$</span><span class="si">%s</span><span class="s">^\mathrm{Isotropic}$&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">draw</span><span class="p">()</span>

        <span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">grid_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span>
                           <span class="n">isotropic_sigma</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">*</span><span class="n">GPA</span><span class="p">,</span> <span class="n">dcontours</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">colorbar</span><span class="p">()</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|</span><span class="si">%s</span><span class="s">^\mathrm{atom} - </span><span class="si">%s</span><span class="s">^\mathrm{isotropic}|$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
        <span class="n">draw</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.print_crack_system">
    <p>def <span class="ident">print_crack_system</span>(</p><p>directions)</p>
    </div>
    

    
  
    <div class="desc"><p>Pretty printing of crack crystallographic coordinate system </p>
<p>Specified by list of Miller indices for crack_direction (x),
cleavage_plane (y) and crack_front (z), each of which should be
a sequence of three floats</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.print_crack_system', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.print_crack_system" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_crack_system</span><span class="p">(</span><span class="n">directions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pretty printing of crack crystallographic coordinate system </span>

<span class="sd">    Specified by list of Miller indices for crack_direction (x),</span>
<span class="sd">    cleavage_plane (y) and crack_front (z), each of which should be</span>
<span class="sd">    a sequence of three floats</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">crack_direction</span><span class="p">,</span> <span class="n">cleavage_plane</span><span class="p">,</span> <span class="n">crack_front</span> <span class="o">=</span> <span class="n">directions</span>
    
    <span class="n">crack_direction</span> <span class="o">=</span> <span class="n">MillerDirection</span><span class="p">(</span><span class="n">crack_direction</span><span class="p">)</span>
    <span class="n">cleavage_plane</span> <span class="o">=</span> <span class="n">MillerPlane</span><span class="p">(</span><span class="n">cleavage_plane</span><span class="p">)</span>
    <span class="n">crack_front</span> <span class="o">=</span> <span class="n">MillerDirection</span><span class="p">(</span><span class="n">crack_front</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack system              </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cleavage_plane</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack direction (x-axis)  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">crack_direction</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Cleavage plane  (y-axis)  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cleavage_plane</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Crack front     (z-axis)  </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">crack_front</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.strain_to_G">
    <p>def <span class="ident">strain_to_G</span>(</p><p>strain, E, nu, orig_height)</p>
    </div>
    

    
  
    <div class="desc"><p>Convert from strain to energy release rate G for thin strip geometry</p>
<h2>Parameters</h2>
<p>strain : float
   Dimensionless ratio <code>(current_height - orig_height)/orig_height</code>
E : float
   Young's modulus relevant for a pull in y direction sigma_yy/eps_yy
nu : float
   Poission ratio -eps_yy/eps_xx
orig_height : float
   Unstrained height of slab</p>
<h2>Returns</h2>
<p>G : float
   Energy release rate in units consistent with input
   (i.e. in eV/A**2 if eV/A/fs units used)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.strain_to_G', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.strain_to_G" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">strain_to_G</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert from strain to energy release rate G for thin strip geometry</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    strain : float</span>
<span class="sd">       Dimensionless ratio ``(current_height - orig_height)/orig_height``</span>
<span class="sd">    E : float</span>
<span class="sd">       Young&#39;s modulus relevant for a pull in y direction sigma_yy/eps_yy</span>
<span class="sd">    nu : float</span>
<span class="sd">       Poission ratio -eps_yy/eps_xx</span>
<span class="sd">    orig_height : float</span>
<span class="sd">       Unstrained height of slab</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    G : float</span>
<span class="sd">       Energy release rate in units consistent with input</span>
<span class="sd">       (i.e. in eV/A**2 if eV/A/fs units used)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">orig_height</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.thin_strip_displacement_y">
    <p>def <span class="ident">thin_strip_displacement_y</span>(</p><p>x, y, strain, a, b)</p>
    </div>
    

    
  
    <div class="desc"><p>Return vertical displacement ramp used to apply initial strain to slab</p>
<p>Strain is increased from 0 to strain over distance :math:<code>a &lt;= x &lt;= b</code>.
Region :math:<code>x &lt; a</code> is rigidly shifted up/down by <code>strain*height/2</code>.</p>
<p>Here is an example of how to use this function on an artificial
2D square atomic lattice. The positions are plotted before (left)
and after (right) applying the displacement, and the horizontal and
vertical lines show the <code>strain</code> (red), <code>a</code> (green) and <code>b</code> (blue)
parameters. ::</p>
<p>import matplotlib.pyplot as plt
   import numpy as np</p>
<p>w = 1; h = 1; strain = 0.1; a = -0.5; b =  0.0
   x = np.linspace(-w, w, 20)
   y = np.linspace(-h, h, 20)
   X, Y = np.meshgrid(x, y)
   u_y = thin_strip_displacement_y(X, Y, strain, a, b)</p>
<p>for i, disp in enumerate([0, u_y]):
       plt.subplot(1,2,i+1)
       plt.scatter(X, Y + disp, c='k', s=5)
       for y in [-h, h]:
           plt.axhline(y, color='r', linewidth=2, linestyle='dashed')
           plt.axhline(y*(1+strain), color='r', linewidth=2)
       for x, c in zip([a, b], ['g', 'b']):
           plt.axvline(x, color=c, linewidth=2)</p>
<p>.. image:: thin-strip-displacement-y.png
   :width: 600
   :align: center</p>
<h2>Parameters</h2>
<p>x : array
y : array
   Atomic positions in unstrained slab, centered on origin x=0,y=0
strain : float
   Far field strain to apply
a : float
   x coordinate for beginning of strain ramp
b : float
   x coordinate for end of strain ramp</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.thin_strip_displacement_y', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.thin_strip_displacement_y" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">thin_strip_displacement_y</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">strain</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return vertical displacement ramp used to apply initial strain to slab</span>

<span class="sd">    Strain is increased from 0 to strain over distance :math:`a &lt;= x &lt;= b`.</span>
<span class="sd">    Region :math:`x &lt; a` is rigidly shifted up/down by ``strain*height/2``.</span>

<span class="sd">    Here is an example of how to use this function on an artificial</span>
<span class="sd">    2D square atomic lattice. The positions are plotted before (left)</span>
<span class="sd">    and after (right) applying the displacement, and the horizontal and</span>
<span class="sd">    vertical lines show the `strain` (red), `a` (green) and `b` (blue)</span>
<span class="sd">    parameters. ::</span>

<span class="sd">       import matplotlib.pyplot as plt</span>
<span class="sd">       import numpy as np</span>

<span class="sd">       w = 1; h = 1; strain = 0.1; a = -0.5; b =  0.0</span>
<span class="sd">       x = np.linspace(-w, w, 20)</span>
<span class="sd">       y = np.linspace(-h, h, 20)</span>
<span class="sd">       X, Y = np.meshgrid(x, y)</span>
<span class="sd">       u_y = thin_strip_displacement_y(X, Y, strain, a, b)</span>

<span class="sd">       for i, disp in enumerate([0, u_y]):</span>
<span class="sd">           plt.subplot(1,2,i+1)</span>
<span class="sd">           plt.scatter(X, Y + disp, c=&#39;k&#39;, s=5)</span>
<span class="sd">           for y in [-h, h]:</span>
<span class="sd">               plt.axhline(y, color=&#39;r&#39;, linewidth=2, linestyle=&#39;dashed&#39;)</span>
<span class="sd">               plt.axhline(y*(1+strain), color=&#39;r&#39;, linewidth=2)</span>
<span class="sd">           for x, c in zip([a, b], [&#39;g&#39;, &#39;b&#39;]):</span>
<span class="sd">               plt.axvline(x, color=c, linewidth=2)</span>

<span class="sd">    .. image:: thin-strip-displacement-y.png</span>
<span class="sd">       :width: 600</span>
<span class="sd">       :align: center</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array</span>
<span class="sd">    y : array</span>
<span class="sd">       Atomic positions in unstrained slab, centered on origin x=0,y=0</span>
<span class="sd">    strain : float</span>
<span class="sd">       Far field strain to apply</span>
<span class="sd">    a : float</span>
<span class="sd">       x coordinate for beginning of strain ramp</span>
<span class="sd">    b : float</span>
<span class="sd">       x coordinate for end of strain ramp</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">u_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>     <span class="c"># measure height of slab</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span>  <span class="c"># far behind crack, shift = strain*height/2</span>

    <span class="n">u_y</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">])</span> <span class="o">*</span> <span class="n">shift</span>  <span class="c"># region shift for x &lt; a</span>
    <span class="n">u_y</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">]</span>          <span class="c"># constant strain for x &gt; b</span>
    
    <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span>            <span class="c"># interpolate for a &lt;= x &lt;= b</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">u_y</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">shift</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">middle</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">u_y</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.ConstantStrainRate" class="name">class <span class="ident">ConstantStrainRate</span></p>
      
  
    <div class="desc"><p>Constraint which increments epsilon_yy at a constant strain rate</p>
<p>Rescaling is applied only to atoms where <code>mask</code> is True (default is all atoms)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.ConstantStrainRate', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.ConstantStrainRate" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ConstantStrainRate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constraint which increments epsilon_yy at a constant strain rate</span>

<span class="sd">    Rescaling is applied only to atoms where `mask` is True (default is all atoms)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">,</span> <span class="n">delta_strain</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span> <span class="o">=</span> <span class="n">orig_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span> <span class="o">=</span> <span class="n">delta_strain</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

    <span class="k">def</span> <span class="nf">adjust_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">forces</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">adjust_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldpos</span><span class="p">,</span> <span class="n">newpos</span><span class="p">):</span>
        <span class="n">current_height</span> <span class="o">=</span> <span class="n">newpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">newpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">current_strain</span> <span class="o">=</span> <span class="n">current_height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span> <span class="o">-</span> <span class="mf">1.0</span>
        <span class="n">new_strain</span> <span class="o">=</span> <span class="n">current_strain</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">new_strain</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">current_strain</span><span class="p">)</span>
        <span class="n">newpos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">newpos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">alpha</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ConstantStrainRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#matscipy.fracture_mechanics.crack.ConstantStrainRate">ConstantStrainRate</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.ConstantStrainRate.delta_strain" class="name">var <span class="ident">delta_strain</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.ConstantStrainRate.mask" class="name">var <span class="ident">mask</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.ConstantStrainRate.orig_height" class="name">var <span class="ident">orig_height</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.ConstantStrainRate.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, orig_height, delta_strain, mask=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.ConstantStrainRate.__init__', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.ConstantStrainRate.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_height</span><span class="p">,</span> <span class="n">delta_strain</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span> <span class="o">=</span> <span class="n">orig_height</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span> <span class="o">=</span> <span class="n">delta_strain</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">Ellipsis</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_forces">
    <p>def <span class="ident">adjust_forces</span>(</p><p>self, positions, forces)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_forces', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_forces" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">adjust_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">forces</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_positions">
    <p>def <span class="ident">adjust_positions</span>(</p><p>self, oldpos, newpos)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_positions', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.ConstantStrainRate.adjust_positions" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">adjust_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldpos</span><span class="p">,</span> <span class="n">newpos</span><span class="p">):</span>
    <span class="n">current_height</span> <span class="o">=</span> <span class="n">newpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">newpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">current_strain</span> <span class="o">=</span> <span class="n">current_height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">new_strain</span> <span class="o">=</span> <span class="n">current_strain</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">new_strain</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">current_strain</span><span class="p">)</span>
    <span class="n">newpos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">newpos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">alpha</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.ConstantStrainRate.copy">
    <p>def <span class="ident">copy</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.ConstantStrainRate.copy', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.ConstantStrainRate.copy" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ConstantStrainRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig_height</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">delta_strain</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.CubicCrystalCrack" class="name">class <span class="ident">CubicCrystalCrack</span></p>
      
  
    <div class="desc"><p>Crack in a cubic crystal.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">CubicCrystalCrack</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crack in a cubic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">,</span> <span class="n">C11</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">C12</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">C44</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Crot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a crack in a cubic crystal with elastic constants C11, C12</span>
<span class="sd">        and C44 (or optionally a full 6x6 elastic constant matrix C).</span>
<span class="sd">        The crack surface is given by crack_surface, the cracks runs</span>
<span class="sd">        in the plane given by crack_front.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># x (third_dir) - direction in which the crack is running</span>
        <span class="c"># y (crack_surface) - free surface that forms due to the crack</span>
        <span class="c"># z (crack_front) - direction of the crack front</span>
        <span class="n">third_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">)</span>
        <span class="n">third_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">third_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">third_dir</span><span class="p">,</span>
                                                         <span class="n">third_dir</span><span class="p">))</span>
        <span class="n">crack_surface</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">)</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">))</span>
        <span class="n">crack_front</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">crack_front</span><span class="p">)</span> <span class="o">/</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">crack_front</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">))</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">third_dir</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">third_dir</span> <span class="o">=</span> <span class="o">-</span><span class="n">third_dir</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">third_dir</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">Crot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">C6</span> <span class="o">=</span> <span class="n">Crot</span>
        <span class="k">elif</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">C6</span> <span class="o">=</span> <span class="n">rotate_elastic_constants</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">C6</span> <span class="o">=</span> <span class="n">rotate_cubic_elastic_constants</span><span class="p">(</span><span class="n">C11</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="n">C44</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crack</span> <span class="o">=</span> <span class="n">RectilinearAnisotropicCrack</span><span class="p">()</span>
        <span class="n">S6</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">C6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S6</span>

        <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">set_plane_stress</span><span class="p">(</span><span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">set_plane_strain</span><span class="p">(</span><span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                        <span class="n">S6</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">k1g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Griffith critical stress intensity in mode I fracture.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        surface_energy : float</span>
<span class="sd">            Surface energy of the respective crystal surface.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        k1g : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">k1g</span><span class="p">(</span><span class="n">surface_energy</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">k1gsqG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">k1gsqG</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cylindrical coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">displacements</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">displacements_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field for a list of cartesian positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ux : array_like</span>
<span class="sd">            x-displacements.</span>
<span class="sd">        uy : array_like</span>
<span class="sd">            y-displacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">deformation_gradient_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cylindrical coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">deformation_gradient</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">deformation_gradient_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture from cartesian coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deformation_gradient_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">deformation_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deformation gradient for a list of cartesian positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ux : array_like</span>
<span class="sd">            x-displacements.</span>
<span class="sd">        uy : array_like</span>
<span class="sd">            y-displacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deformation_gradient_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">crack_tip_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">residual_func</span><span class="o">=</span><span class="n">displacement_residual</span><span class="p">,</span>
                           <span class="n">method</span><span class="o">=</span><span class="s">&#39;Powell&#39;</span><span class="p">,</span> <span class="n">return_residuals</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an estimate of the real crack tip position by minimizing the </span>
<span class="sd">        mean square error of the current configuration relative to the</span>
<span class="sd">        diplacement field obtained for a stress intensity factor k from linear</span>
<span class="sd">        elastic fracture mechanics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            y-positions of the atomic system containing the crack.</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            Initial guess for the x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            Initial guess for the y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        mask : array_like, optional</span>
<span class="sd">            Marks the atoms to use for this calculation.</span>
<span class="sd">        residual_func : function</span>
<span class="sd">            Function returning per-atom residuals to be minimized.</span>
<span class="sd">        method : str</span>
<span class="sd">            Optimization method. See method argument of scipy.optimize.minimize.</span>
<span class="sd">            Additionally, &#39;leastsq&#39; invokes scipy.optimize.leastsq.</span>
<span class="sd">        return_residuals : bool</span>
<span class="sd">            Function returns residuals if set to True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        residuals : array, optional</span>
<span class="sd">            Per-atom residuals at end of optimization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;leastsq&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">residual_func</span><span class="p">,</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">(</span><span class="n">residual_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                           <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span>
                           <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip. Reason: {}&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">return_residuals</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">residual_func</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>


    <span class="k">def</span> <span class="nf">_residual_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="n">dux</span><span class="p">,</span> <span class="n">duy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_residuals</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">dux</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">+</span><span class="n">duy</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">duy</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">crack_tip_position_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an estimate of the y-coordinate of the real crack tip position </span>
<span class="sd">        assuming the stress intensity factor is k.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            y-positions of the atomic system containing the crack.</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            Initial guess for the x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            Initial guess for the y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>
<span class="sd">        mask : array_like, optional</span>
<span class="sd">            Marks the atoms to use for this calculation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="p">(</span> <span class="n">y0</span><span class="p">,</span> <span class="p">),</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_residual_y</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y0</span>


    <span class="k">def</span> <span class="nf">scale_displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">old_k</span><span class="p">,</span> <span class="n">new_k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rescale atomic positions from stress intensity factor old_k to the new</span>
<span class="sd">        stress intensity factor new_k. This is useful for extrapolation of </span>
<span class="sd">        relaxed positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            y-positions of the atomic system containing the crack.</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        old_k : float</span>
<span class="sd">            Current stress intensity factor.</span>
<span class="sd">        new_k : float</span>
<span class="sd">            Stress intensity factor for the output positions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            New x-positions of the atomic system containing the crack.</span>
<span class="sd">        y : array_like</span>
<span class="sd">            New y-positions of the atomic system containing the crack.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ref_x</span> <span class="o">+</span> <span class="n">new_k</span><span class="o">/</span><span class="n">old_k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">ref_x</span><span class="p">),</span> <span class="n">ref_y</span> <span class="o">+</span> <span class="n">new_k</span><span class="o">/</span><span class="n">old_k</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">ref_y</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stresses_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field in mode I fracture from cylindrical coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">stresses</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stresses_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field in mode I fracture from cartesian coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field for a list of cartesian positions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_x : array_like</span>
<span class="sd">            x-positions of the reference crystal.</span>
<span class="sd">        ref_y : array_like</span>
<span class="sd">            y-positions of the reference crystal.</span>
<span class="sd">        x0 : float</span>
<span class="sd">            x-coordinate of the crack tip.</span>
<span class="sd">        y0 : float</span>
<span class="sd">            y-coordinate of the crack tip.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sig_x : array_like</span>
<span class="sd">            xx-component of the stress tensor</span>

<span class="sd">        sig_y : array_like</span>
<span class="sd">            yy-component of the stress tensor</span>

<span class="sd">        sig_xy : array_like</span>
<span class="sd">            xy-component of the stress tensor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#matscipy.fracture_mechanics.crack.CubicCrystalCrack">CubicCrystalCrack</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.C" class="name">var <span class="ident">C</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.S" class="name">var <span class="ident">S</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack" class="name">var <span class="ident">crack</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, crack_surface, crack_front, C11=None, C12=None, C44=None, stress_state=&#39;plane strain&#39;, C=None, Crot=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize a crack in a cubic crystal with elastic constants C11, C12
and C44 (or optionally a full 6x6 elastic constant matrix C).
The crack surface is given by crack_surface, the cracks runs
in the plane given by crack_front.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.__init__', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">,</span> <span class="n">C11</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">C12</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">C44</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stress_state</span><span class="o">=</span><span class="n">PLANE_STRAIN</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Crot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a crack in a cubic crystal with elastic constants C11, C12</span>
<span class="sd">    and C44 (or optionally a full 6x6 elastic constant matrix C).</span>
<span class="sd">    The crack surface is given by crack_surface, the cracks runs</span>
<span class="sd">    in the plane given by crack_front.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># x (third_dir) - direction in which the crack is running</span>
    <span class="c"># y (crack_surface) - free surface that forms due to the crack</span>
    <span class="c"># z (crack_front) - direction of the crack front</span>
    <span class="n">third_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">)</span>
    <span class="n">third_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">third_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">third_dir</span><span class="p">,</span>
                                                     <span class="n">third_dir</span><span class="p">))</span>
    <span class="n">crack_surface</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">)</span> <span class="o">/</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">))</span>
    <span class="n">crack_front</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">crack_front</span><span class="p">)</span> <span class="o">/</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">crack_front</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">third_dir</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">third_dir</span> <span class="o">=</span> <span class="o">-</span><span class="n">third_dir</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">third_dir</span><span class="p">,</span> <span class="n">crack_surface</span><span class="p">,</span> <span class="n">crack_front</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">Crot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">C6</span> <span class="o">=</span> <span class="n">Crot</span>
    <span class="k">elif</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">C6</span> <span class="o">=</span> <span class="n">rotate_elastic_constants</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C6</span> <span class="o">=</span> <span class="n">rotate_cubic_elastic_constants</span><span class="p">(</span><span class="n">C11</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="n">C44</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crack</span> <span class="o">=</span> <span class="n">RectilinearAnisotropicCrack</span><span class="p">()</span>
    <span class="n">S6</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">C6</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C6</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S6</span>
    <span class="k">if</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRESS</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">set_plane_stress</span><span class="p">(</span><span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">stress_state</span> <span class="o">==</span> <span class="n">PLANE_STRAIN</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">set_plane_strain</span><span class="p">(</span><span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                    <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                    <span class="n">S6</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">S6</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                    <span class="n">S6</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position">
    <p>def <span class="ident">crack_tip_position</span>(</p><p>self, x, y, ref_x, ref_y, x0, y0, k, mask=None, residual_func=&lt;function displacement_residual at 0x6fffdd71230&gt;, method=&#39;Powell&#39;, return_residuals=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Return an estimate of the real crack tip position by minimizing the 
mean square error of the current configuration relative to the
diplacement field obtained for a stress intensity factor k from linear
elastic fracture mechanics.</p>
<h2>Parameters</h2>
<p>x : array_like
    x-positions of the atomic system containing the crack.
y : array_like
    y-positions of the atomic system containing the crack.
ref_x : array_like
    x-positions of the reference crystal.
ref_y : array_like
    y-positions of the reference crystal.
x0 : float
    Initial guess for the x-coordinate of the crack tip.
y0 : float
    Initial guess for the y-coordinate of the crack tip.
k : float
    Stress intensity factor.
mask : array_like, optional
    Marks the atoms to use for this calculation.
residual_func : function
    Function returning per-atom residuals to be minimized.
method : str
    Optimization method. See method argument of scipy.optimize.minimize.
    Additionally, 'leastsq' invokes scipy.optimize.leastsq.
return_residuals : bool
    Function returns residuals if set to True.</p>
<h2>Returns</h2>
<p>x0 : float
    x-coordinate of the crack tip.
y0 : float
    y-coordinate of the crack tip.
residuals : array, optional
    Per-atom residuals at end of optimization.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">crack_tip_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">residual_func</span><span class="o">=</span><span class="n">displacement_residual</span><span class="p">,</span>
                       <span class="n">method</span><span class="o">=</span><span class="s">&#39;Powell&#39;</span><span class="p">,</span> <span class="n">return_residuals</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return an estimate of the real crack tip position by minimizing the </span>
<span class="sd">    mean square error of the current configuration relative to the</span>
<span class="sd">    diplacement field obtained for a stress intensity factor k from linear</span>
<span class="sd">    elastic fracture mechanics.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        x-positions of the atomic system containing the crack.</span>
<span class="sd">    y : array_like</span>
<span class="sd">        y-positions of the atomic system containing the crack.</span>
<span class="sd">    ref_x : array_like</span>
<span class="sd">        x-positions of the reference crystal.</span>
<span class="sd">    ref_y : array_like</span>
<span class="sd">        y-positions of the reference crystal.</span>
<span class="sd">    x0 : float</span>
<span class="sd">        Initial guess for the x-coordinate of the crack tip.</span>
<span class="sd">    y0 : float</span>
<span class="sd">        Initial guess for the y-coordinate of the crack tip.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    mask : array_like, optional</span>
<span class="sd">        Marks the atoms to use for this calculation.</span>
<span class="sd">    residual_func : function</span>
<span class="sd">        Function returning per-atom residuals to be minimized.</span>
<span class="sd">    method : str</span>
<span class="sd">        Optimization method. See method argument of scipy.optimize.minimize.</span>
<span class="sd">        Additionally, &#39;leastsq&#39; invokes scipy.optimize.leastsq.</span>
<span class="sd">    return_residuals : bool</span>
<span class="sd">        Function returns residuals if set to True.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x0 : float</span>
<span class="sd">        x-coordinate of the crack tip.</span>
<span class="sd">    y0 : float</span>
<span class="sd">        y-coordinate of the crack tip.</span>
<span class="sd">    residuals : array, optional</span>
<span class="sd">        Per-atom residuals at end of optimization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;leastsq&#39;</span><span class="p">:</span>
        <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">residual_func</span><span class="p">,</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">(</span><span class="n">residual_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                       <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span>
                       <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip. Reason: {}&#39;</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span>
    <span class="k">if</span> <span class="n">return_residuals</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">residual_func</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position_y">
    <p>def <span class="ident">crack_tip_position_y</span>(</p><p>self, x, y, ref_x, ref_y, x0, y0, k, mask=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Return an estimate of the y-coordinate of the real crack tip position 
assuming the stress intensity factor is k.</p>
<h2>Parameters</h2>
<p>x : array_like
    x-positions of the atomic system containing the crack.
y : array_like
    y-positions of the atomic system containing the crack.
ref_x : array_like
    x-positions of the reference crystal.
ref_y : array_like
    y-positions of the reference crystal.
x0 : float
    Initial guess for the x-coordinate of the crack tip.
y0 : float
    Initial guess for the y-coordinate of the crack tip.
k : float
    Stress intensity factor.
mask : array_like, optional
    Marks the atoms to use for this calculation.</p>
<h2>Returns</h2>
<p>y0 : float
    y-coordinate of the crack tip</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position_y', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.crack_tip_position_y" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">crack_tip_position_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return an estimate of the y-coordinate of the real crack tip position </span>
<span class="sd">    assuming the stress intensity factor is k.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        x-positions of the atomic system containing the crack.</span>
<span class="sd">    y : array_like</span>
<span class="sd">        y-positions of the atomic system containing the crack.</span>
<span class="sd">    ref_x : array_like</span>
<span class="sd">        x-positions of the reference crystal.</span>
<span class="sd">    ref_y : array_like</span>
<span class="sd">        y-positions of the reference crystal.</span>
<span class="sd">    x0 : float</span>
<span class="sd">        Initial guess for the x-coordinate of the crack tip.</span>
<span class="sd">    y0 : float</span>
<span class="sd">        Initial guess for the y-coordinate of the crack tip.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    mask : array_like, optional</span>
<span class="sd">        Marks the atoms to use for this calculation.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y0 : float</span>
<span class="sd">        y-coordinate of the crack tip</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="p">(</span> <span class="n">y0</span><span class="p">,</span> <span class="p">),</span> <span class="n">ier</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_residual_y</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span>
                      <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Could not find crack tip&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y0</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient">
    <p>def <span class="ident">deformation_gradient</span>(</p><p>self, ref_x, ref_y, x0, y0, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Deformation gradient for a list of cartesian positions.</p>
<h2>Parameters</h2>
<p>ref_x : array_like
    x-positions of the reference crystal.
ref_y : array_like
    y-positions of the reference crystal.
x0 : float
    x-coordinate of the crack tip.
y0 : float
    y-coordinate of the crack tip.
k : float
    Stress intensity factor.</p>
<h2>Returns</h2>
<p>ux : array_like
    x-displacements.
uy : array_like
    y-displacements.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">deformation_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deformation gradient for a list of cartesian positions.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref_x : array_like</span>
<span class="sd">        x-positions of the reference crystal.</span>
<span class="sd">    ref_y : array_like</span>
<span class="sd">        y-positions of the reference crystal.</span>
<span class="sd">    x0 : float</span>
<span class="sd">        x-coordinate of the crack tip.</span>
<span class="sd">    y0 : float</span>
<span class="sd">        y-coordinate of the crack tip.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ux : array_like</span>
<span class="sd">        x-displacements.</span>
<span class="sd">    uy : array_like</span>
<span class="sd">        y-displacements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deformation_gradient_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cartesian_coordinates">
    <p>def <span class="ident">deformation_gradient_from_cartesian_coordinates</span>(</p><p>self, dx, dy, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Displacement field in mode I fracture from cartesian coordinates.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cartesian_coordinates', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cartesian_coordinates" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">deformation_gradient_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displacement field in mode I fracture from cartesian coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deformation_gradient_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cylinder_coordinates">
    <p>def <span class="ident">deformation_gradient_from_cylinder_coordinates</span>(</p><p>self, r, theta, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Displacement field in mode I fracture from cylindrical coordinates.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cylinder_coordinates', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.deformation_gradient_from_cylinder_coordinates" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">deformation_gradient_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displacement field in mode I fracture from cylindrical coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">deformation_gradient</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements">
    <p>def <span class="ident">displacements</span>(</p><p>self, ref_x, ref_y, x0, y0, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Displacement field for a list of cartesian positions.</p>
<h2>Parameters</h2>
<p>ref_x : array_like
    x-positions of the reference crystal.
ref_y : array_like
    y-positions of the reference crystal.
x0 : float
    x-coordinate of the crack tip.
y0 : float
    y-coordinate of the crack tip.
k : float
    Stress intensity factor.</p>
<h2>Returns</h2>
<p>ux : array_like
    x-displacements.
uy : array_like
    y-displacements.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displacement field for a list of cartesian positions.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref_x : array_like</span>
<span class="sd">        x-positions of the reference crystal.</span>
<span class="sd">    ref_y : array_like</span>
<span class="sd">        y-positions of the reference crystal.</span>
<span class="sd">    x0 : float</span>
<span class="sd">        x-coordinate of the crack tip.</span>
<span class="sd">    y0 : float</span>
<span class="sd">        y-coordinate of the crack tip.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ux : array_like</span>
<span class="sd">        x-displacements.</span>
<span class="sd">    uy : array_like</span>
<span class="sd">        y-displacements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cartesian_coordinates">
    <p>def <span class="ident">displacements_from_cartesian_coordinates</span>(</p><p>self, dx, dy, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Displacement field in mode I fracture from cartesian coordinates.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cartesian_coordinates', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cartesian_coordinates" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">displacements_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displacement field in mode I fracture from cartesian coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cylinder_coordinates">
    <p>def <span class="ident">displacements_from_cylinder_coordinates</span>(</p><p>self, r, theta, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Displacement field in mode I fracture from cylindrical coordinates.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cylinder_coordinates', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.displacements_from_cylinder_coordinates" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">displacements_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displacement field in mode I fracture from cylindrical coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">displacements</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1g">
    <p>def <span class="ident">k1g</span>(</p><p>self, surface_energy)</p>
    </div>
    

    
  
    <div class="desc"><p>Compute Griffith critical stress intensity in mode I fracture.</p>
<h2>Parameters</h2>
<p>surface_energy : float
    Surface energy of the respective crystal surface.</p>
<h2>Returns</h2>
<p>k1g : float
    Stress intensity factor.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1g', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1g" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">k1g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_energy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Griffith critical stress intensity in mode I fracture.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    surface_energy : float</span>
<span class="sd">        Surface energy of the respective crystal surface.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    k1g : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">k1g</span><span class="p">(</span><span class="n">surface_energy</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1gsqG">
    <p>def <span class="ident">k1gsqG</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1gsqG', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.k1gsqG" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">k1gsqG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">k1gsqG</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.scale_displacements">
    <p>def <span class="ident">scale_displacements</span>(</p><p>self, x, y, ref_x, ref_y, old_k, new_k)</p>
    </div>
    

    
  
    <div class="desc"><p>Rescale atomic positions from stress intensity factor old_k to the new
stress intensity factor new_k. This is useful for extrapolation of 
relaxed positions.</p>
<h2>Parameters</h2>
<p>x : array_like
    x-positions of the atomic system containing the crack.
y : array_like
    y-positions of the atomic system containing the crack.
ref_x : array_like
    x-positions of the reference crystal.
ref_y : array_like
    y-positions of the reference crystal.
old_k : float
    Current stress intensity factor.
new_k : float
    Stress intensity factor for the output positions.</p>
<h2>Returns</h2>
<p>x : array_like
    New x-positions of the atomic system containing the crack.
y : array_like
    New y-positions of the atomic system containing the crack.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.scale_displacements', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.scale_displacements" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">scale_displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">old_k</span><span class="p">,</span> <span class="n">new_k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rescale atomic positions from stress intensity factor old_k to the new</span>
<span class="sd">    stress intensity factor new_k. This is useful for extrapolation of </span>
<span class="sd">    relaxed positions.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        x-positions of the atomic system containing the crack.</span>
<span class="sd">    y : array_like</span>
<span class="sd">        y-positions of the atomic system containing the crack.</span>
<span class="sd">    ref_x : array_like</span>
<span class="sd">        x-positions of the reference crystal.</span>
<span class="sd">    ref_y : array_like</span>
<span class="sd">        y-positions of the reference crystal.</span>
<span class="sd">    old_k : float</span>
<span class="sd">        Current stress intensity factor.</span>
<span class="sd">    new_k : float</span>
<span class="sd">        Stress intensity factor for the output positions.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        New x-positions of the atomic system containing the crack.</span>
<span class="sd">    y : array_like</span>
<span class="sd">        New y-positions of the atomic system containing the crack.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ref_x</span> <span class="o">+</span> <span class="n">new_k</span><span class="o">/</span><span class="n">old_k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">ref_x</span><span class="p">),</span> <span class="n">ref_y</span> <span class="o">+</span> <span class="n">new_k</span><span class="o">/</span><span class="n">old_k</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">ref_y</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses">
    <p>def <span class="ident">stresses</span>(</p><p>self, ref_x, ref_y, x0, y0, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Stress field for a list of cartesian positions</p>
<h2>Parameters</h2>
<p>ref_x : array_like
    x-positions of the reference crystal.
ref_y : array_like
    y-positions of the reference crystal.
x0 : float
    x-coordinate of the crack tip.
y0 : float
    y-coordinate of the crack tip.
k : float
    Stress intensity factor.</p>
<h2>Returns</h2>
<p>sig_x : array_like
    xx-component of the stress tensor</p>
<p>sig_y : array_like
    yy-component of the stress tensor</p>
<p>sig_xy : array_like
    xy-component of the stress tensor</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stress field for a list of cartesian positions</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ref_x : array_like</span>
<span class="sd">        x-positions of the reference crystal.</span>
<span class="sd">    ref_y : array_like</span>
<span class="sd">        y-positions of the reference crystal.</span>
<span class="sd">    x0 : float</span>
<span class="sd">        x-coordinate of the crack tip.</span>
<span class="sd">    y0 : float</span>
<span class="sd">        y-coordinate of the crack tip.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sig_x : array_like</span>
<span class="sd">        xx-component of the stress tensor</span>
<span class="sd">    sig_y : array_like</span>
<span class="sd">        yy-component of the stress tensor</span>
<span class="sd">    sig_xy : array_like</span>
<span class="sd">        xy-component of the stress tensor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">ref_x</span> <span class="o">-</span> <span class="n">x0</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">ref_y</span> <span class="o">-</span> <span class="n">y0</span>
    <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses_from_cartesian_coordinates</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cartesian_coordinates">
    <p>def <span class="ident">stresses_from_cartesian_coordinates</span>(</p><p>self, dx, dy, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Stress field in mode I fracture from cartesian coordinates</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cartesian_coordinates', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cartesian_coordinates" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">stresses_from_cartesian_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stress field in mode I fracture from cartesian coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses_from_cylinder_coordinates</span><span class="p">(</span><span class="n">abs_dr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cylinder_coordinates">
    <p>def <span class="ident">stresses_from_cylinder_coordinates</span>(</p><p>self, r, theta, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Stress field in mode I fracture from cylindrical coordinates</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cylinder_coordinates', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.CubicCrystalCrack.stresses_from_cylinder_coordinates" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">stresses_from_cylinder_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stress field in mode I fracture from cylindrical coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">crack</span><span class="o">.</span><span class="n">stresses</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.IsotropicStressField" class="name">class <span class="ident">IsotropicStressField</span></p>
      
  
    <div class="desc"><p>Calculator to return Irwin near-tip stress field at atomic sites</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.IsotropicStressField', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.IsotropicStressField" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">IsotropicStressField</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculator to return Irwin near-tip stress field at atomic sites</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sxx0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">syy0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sxy0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">stress_state</span><span class="o">=</span><span class="s">&#39;plane strain&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sxx0</span> <span class="o">=</span> <span class="n">sxx0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syy0</span> <span class="o">=</span> <span class="n">syy0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span> <span class="o">=</span> <span class="n">sxy0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stress_state</span> <span class="o">=</span> <span class="n">stress_state</span>

    <span class="k">def</span> <span class="nf">get_stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span>
        <span class="k">if</span> <span class="n">K</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">y0</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
        
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">stress_state</span><span class="p">)</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxx0</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">syy0</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span>
        <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span>

        <span class="k">return</span> <span class="n">sigma</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#matscipy.fracture_mechanics.crack.IsotropicStressField">IsotropicStressField</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.K" class="name">var <span class="ident">K</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.nu" class="name">var <span class="ident">nu</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.stress_state" class="name">var <span class="ident">stress_state</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.sxx0" class="name">var <span class="ident">sxx0</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.sxy0" class="name">var <span class="ident">sxy0</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.syy0" class="name">var <span class="ident">syy0</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.x0" class="name">var <span class="ident">x0</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.IsotropicStressField.y0" class="name">var <span class="ident">y0</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.IsotropicStressField.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, K=None, x0=None, y0=None, sxx0=0.0, syy0=0.0, sxy0=0.0, nu=0.5, stress_state=&#39;plane strain&#39;)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.IsotropicStressField.__init__', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.IsotropicStressField.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sxx0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">syy0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sxy0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
             <span class="n">stress_state</span><span class="o">=</span><span class="s">&#39;plane strain&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sxx0</span> <span class="o">=</span> <span class="n">sxx0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">syy0</span> <span class="o">=</span> <span class="n">syy0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span> <span class="o">=</span> <span class="n">sxy0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stress_state</span> <span class="o">=</span> <span class="n">stress_state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.IsotropicStressField.get_stresses">
    <p>def <span class="ident">get_stresses</span>(</p><p>self, atoms)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.IsotropicStressField.get_stresses', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.IsotropicStressField.get_stresses" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span>
    <span class="k">if</span> <span class="n">K</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">get_stress_intensity_factor</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
    <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">y0</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;CrackPos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">x</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
    
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">isotropic_modeI_crack_tip_stress_field</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">stress_state</span><span class="p">)</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxx0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">syy0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span>
    <span class="n">sigma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sxy0</span>
    <span class="k">return</span> <span class="n">sigma</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack" class="name">class <span class="ident">RectilinearAnisotropicCrack</span></p>
      
  
    <div class="desc"><p>Near field solution for a crack in a rectilinear anisotropic elastic medium.
See:
G. C. Sih, P. C. Paris and G. R. Irwin, Int. J. Frac. Mech. 1, 189 (1965)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">RectilinearAnisotropicCrack</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Near field solution for a crack in a rectilinear anisotropic elastic medium.</span>
<span class="sd">    See:</span>
<span class="sd">    G. C. Sih, P. C. Paris and G. R. Irwin, Int. J. Frac. Mech. 1, 189 (1965)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="nf">set_plane_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a11</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a16</span><span class="p">,</span> <span class="n">a26</span><span class="p">,</span> <span class="n">a66</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">a11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">a22</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="n">a12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="n">a16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="n">a26</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="n">a66</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_crack</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">set_plane_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b11</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">b33</span><span class="p">,</span> <span class="n">b12</span><span class="p">,</span> <span class="n">b13</span><span class="p">,</span> <span class="n">b23</span><span class="p">,</span> <span class="n">b16</span><span class="p">,</span> <span class="n">b26</span><span class="p">,</span> <span class="n">b36</span><span class="p">,</span> 
                         <span class="n">b66</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">b11</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b13</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">b22</span> <span class="o">-</span> <span class="p">(</span><span class="n">b23</span><span class="o">*</span><span class="n">b23</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="n">b12</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b23</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="n">b16</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b36</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="n">b26</span> <span class="o">-</span> <span class="p">(</span><span class="n">b23</span><span class="o">*</span><span class="n">b36</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="n">b66</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_crack</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_init_crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize dependent parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a16</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a12</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a66</span><span class="p">,</span>
                         <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a26</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="p">]</span> <span class="p">)</span>

        <span class="n">mu1</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">mu3</span><span class="p">,</span> <span class="n">mu4</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">r</span>

        <span class="k">if</span> <span class="n">mu1</span> <span class="o">!=</span> <span class="n">mu2</span><span class="o">.</span><span class="n">conjugate</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Roots not in pairs.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mu3</span> <span class="o">!=</span> <span class="n">mu4</span><span class="o">.</span><span class="n">conjugate</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Roots not in pairs.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">=</span> <span class="n">mu1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">=</span> <span class="n">mu3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a16</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a16</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a26</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q2</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a12</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a26</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span>


    <span class="k">def</span> <span class="nf">displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displacement field in mode I fracture. Positions are passed in cyclinder</span>
<span class="sd">        coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : array_like</span>
<span class="sd">            Distances from the crack tip.</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            Angles with respect to the plane of the crack.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        u : array</span>
<span class="sd">            Displacements parallel to the plane of the crack.</span>
<span class="sd">        v : array</span>
<span class="sd">            Displacements normal to the plane of the crack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span><span class="o">*</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span><span class="o">*</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span><span class="o">*</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span><span class="o">*</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>

        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>


    <span class="k">def</span> <span class="nf">deformation_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deformation gradient tensor in mode I fracture. Positions are passed in</span>
<span class="sd">        cyclinder coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : array_like</span>
<span class="sd">            Distances from the crack tip.</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            Angles with respect to the plane of the crack.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        du_dx : array</span>
<span class="sd">            Derivatives of displacements parallel to the plane within the plane.</span>
<span class="sd">        du_dy : array</span>
<span class="sd">            Derivatives of displacements parallel to the plane perpendicular to</span>
<span class="sd">            the plane.</span>
<span class="sd">        dv_dx : array</span>
<span class="sd">            Derivatives of displacements normal to the plane of the crack within</span>
<span class="sd">            the plane.</span>
<span class="sd">        dv_dy : array</span>
<span class="sd">            Derivatives of displacements normal to the plane of the crack </span>
<span class="sd">            perpendicular to the plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">du_dx</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">du_dy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>

        <span class="n">dv_dx</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
        <span class="n">dv_dy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>

        <span class="c"># We need to add unity matrix to turn this into the deformation gradient</span>
        <span class="c"># tensor.</span>
        <span class="n">du_dx</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">du_dx</span><span class="p">)</span>
        <span class="n">dv_dy</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">dv_dy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([[</span><span class="n">du_dx</span><span class="p">,</span> <span class="n">du_dy</span><span class="p">],</span> <span class="p">[</span><span class="n">dv_dx</span><span class="p">,</span> <span class="n">dv_dy</span><span class="p">]])</span>


    <span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stress field in mode I fracture. Positions are passed in cylinder</span>
<span class="sd">        coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : array_like</span>
<span class="sd">            Distances from the crack tip.</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            Angles with respect to the plane of the crack.</span>
<span class="sd">        k : float</span>
<span class="sd">            Stress intensity factor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sig_x : array</span>
<span class="sd">            Diagonal component of stress tensor parallel to the plane of the</span>
<span class="sd">            crack.</span>
<span class="sd">        sig_y : array</span>
<span class="sd">            Diagonal component of stress tensor normal to the plane of the</span>
<span class="sd">            crack.</span>
<span class="sd">        sig_xy : array</span>
<span class="sd">            Off-diagonal component of the stress tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">sig_x</span>  <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
        <span class="n">sig_y</span>  <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
        <span class="n">sig_xy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>

        <span class="k">return</span> <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span>


    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

        <span class="k">return</span> <span class="n">v</span> <span class="o">-</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span> \
            <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>


    <span class="k">def</span> <span class="nf">rtheta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Invert displacement field in mode I fracture, i.e. compute r and theta</span>
<span class="sd">        from displacements.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># u/v = (self.mu1_p2*h2 - self.mu2_p1*h3)/(self.mu1_q2*h2-self.mu2_q1*h3)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">/</span><span class="n">v</span><span class="p">))</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

        <span class="n">sqrt_2_r</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">k</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">sqrt_2_r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">sqrt_2_r</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">k</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">sqrt_2_r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">r1</span><span class="o">+</span><span class="n">r2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">theta</span> <span class="p">)</span>


    <span class="k">def</span> <span class="nf">k1g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        K1G, Griffith critical stress intensity in mode I fracture</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">surface_energy</span> <span class="o">/</span> \
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">*</span>
                          <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">))</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">k1gsqG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">))</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack">RectilinearAnisotropicCrack</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.a11" class="name">var <span class="ident">a11</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.a12" class="name">var <span class="ident">a12</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.a16" class="name">var <span class="ident">a16</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.a22" class="name">var <span class="ident">a22</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.a26" class="name">var <span class="ident">a26</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.a66" class="name">var <span class="ident">a66</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.__init__', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.deformation_gradient">
    <p>def <span class="ident">deformation_gradient</span>(</p><p>self, r, theta, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Deformation gradient tensor in mode I fracture. Positions are passed in
cyclinder coordinates.</p>
<h2>Parameters</h2>
<p>r : array_like
    Distances from the crack tip.
theta : array_like
    Angles with respect to the plane of the crack.
k : float
    Stress intensity factor.</p>
<h2>Returns</h2>
<p>du_dx : array
    Derivatives of displacements parallel to the plane within the plane.
du_dy : array
    Derivatives of displacements parallel to the plane perpendicular to
    the plane.
dv_dx : array
    Derivatives of displacements normal to the plane of the crack within
    the plane.
dv_dy : array
    Derivatives of displacements normal to the plane of the crack 
    perpendicular to the plane.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.deformation_gradient', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.deformation_gradient" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">deformation_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deformation gradient tensor in mode I fracture. Positions are passed in</span>
<span class="sd">    cyclinder coordinates.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r : array_like</span>
<span class="sd">        Distances from the crack tip.</span>
<span class="sd">    theta : array_like</span>
<span class="sd">        Angles with respect to the plane of the crack.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    du_dx : array</span>
<span class="sd">        Derivatives of displacements parallel to the plane within the plane.</span>
<span class="sd">    du_dy : array</span>
<span class="sd">        Derivatives of displacements parallel to the plane perpendicular to</span>
<span class="sd">        the plane.</span>
<span class="sd">    dv_dx : array</span>
<span class="sd">        Derivatives of displacements normal to the plane of the crack within</span>
<span class="sd">        the plane.</span>
<span class="sd">    dv_dy : array</span>
<span class="sd">        Derivatives of displacements normal to the plane of the crack </span>
<span class="sd">        perpendicular to the plane.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">du_dx</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">du_dy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">dv_dx</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">dv_dy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span><span class="o">/</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="c"># We need to add unity matrix to turn this into the deformation gradient</span>
    <span class="c"># tensor.</span>
    <span class="n">du_dx</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">du_dx</span><span class="p">)</span>
    <span class="n">dv_dy</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">dv_dy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([[</span><span class="n">du_dx</span><span class="p">,</span> <span class="n">du_dy</span><span class="p">],</span> <span class="p">[</span><span class="n">dv_dx</span><span class="p">,</span> <span class="n">dv_dy</span><span class="p">]])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.displacements">
    <p>def <span class="ident">displacements</span>(</p><p>self, r, theta, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Displacement field in mode I fracture. Positions are passed in cyclinder
coordinates.</p>
<h2>Parameters</h2>
<p>r : array_like
    Distances from the crack tip.
theta : array_like
    Angles with respect to the plane of the crack.
k : float
    Stress intensity factor.</p>
<h2>Returns</h2>
<p>u : array
    Displacements parallel to the plane of the crack.
v : array
    Displacements normal to the plane of the crack.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.displacements', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.displacements" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">displacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displacement field in mode I fracture. Positions are passed in cyclinder</span>
<span class="sd">    coordinates.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r : array_like</span>
<span class="sd">        Distances from the crack tip.</span>
<span class="sd">    theta : array_like</span>
<span class="sd">        Angles with respect to the plane of the crack.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : array</span>
<span class="sd">        Displacements parallel to the plane of the crack.</span>
<span class="sd">    v : array</span>
<span class="sd">        Displacements normal to the plane of the crack.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span><span class="o">*</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span><span class="o">*</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">h1</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span><span class="o">*</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span><span class="o">*</span><span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1g">
    <p>def <span class="ident">k1g</span>(</p><p>self, surface_energy)</p>
    </div>
    

    
  
    <div class="desc"><p>K1G, Griffith critical stress intensity in mode I fracture</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1g', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1g" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">k1g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_energy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    K1G, Griffith critical stress intensity in mode I fracture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">surface_energy</span> <span class="o">/</span> \
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">*</span>
                      <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">))</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1gsqG">
    <p>def <span class="ident">k1gsqG</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1gsqG', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.k1gsqG" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">k1gsqG</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">))</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.rtheta">
    <p>def <span class="ident">rtheta</span>(</p><p>self, u, v, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Invert displacement field in mode I fracture, i.e. compute r and theta
from displacements.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.rtheta', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.rtheta" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">rtheta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invert displacement field in mode I fracture, i.e. compute r and theta</span>
<span class="sd">    from displacements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># u/v = (self.mu1_p2*h2 - self.mu2_p1*h3)/(self.mu1_q2*h2-self.mu2_q1*h3)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">/</span><span class="n">v</span><span class="p">))</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">sqrt_2_r</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_p2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_p1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">k</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">sqrt_2_r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">sqrt_2_r</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1_q2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2_q1</span> <span class="o">*</span> <span class="n">h3</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">k</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">sqrt_2_r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">r1</span><span class="o">+</span><span class="n">r2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">theta</span> <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_strain">
    <p>def <span class="ident">set_plane_strain</span>(</p><p>self, b11, b22, b33, b12, b13, b23, b16, b26, b36, b66)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_strain', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_strain" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">set_plane_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b11</span><span class="p">,</span> <span class="n">b22</span><span class="p">,</span> <span class="n">b33</span><span class="p">,</span> <span class="n">b12</span><span class="p">,</span> <span class="n">b13</span><span class="p">,</span> <span class="n">b23</span><span class="p">,</span> <span class="n">b16</span><span class="p">,</span> <span class="n">b26</span><span class="p">,</span> <span class="n">b36</span><span class="p">,</span> 
                     <span class="n">b66</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">b11</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b13</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">b22</span> <span class="o">-</span> <span class="p">(</span><span class="n">b23</span><span class="o">*</span><span class="n">b23</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="n">b12</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b23</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="n">b16</span> <span class="o">-</span> <span class="p">(</span><span class="n">b13</span><span class="o">*</span><span class="n">b36</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="n">b26</span> <span class="o">-</span> <span class="p">(</span><span class="n">b23</span><span class="o">*</span><span class="n">b36</span><span class="p">)</span><span class="o">/</span><span class="n">b33</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="n">b66</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_crack</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_stress">
    <p>def <span class="ident">set_plane_stress</span>(</p><p>self, a11, a22, a12, a16, a26, a66)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_stress', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.set_plane_stress" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">set_plane_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a11</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a16</span><span class="p">,</span> <span class="n">a26</span><span class="p">,</span> <span class="n">a66</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="n">a11</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="n">a22</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a12</span> <span class="o">=</span> <span class="n">a12</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a16</span> <span class="o">=</span> <span class="n">a16</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a26</span> <span class="o">=</span> <span class="n">a26</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a66</span> <span class="o">=</span> <span class="n">a66</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_crack</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.stresses">
    <p>def <span class="ident">stresses</span>(</p><p>self, r, theta, k)</p>
    </div>
    

    
  
    <div class="desc"><p>Stress field in mode I fracture. Positions are passed in cylinder
coordinates.</p>
<h2>Parameters</h2>
<p>r : array_like
    Distances from the crack tip.
theta : array_like
    Angles with respect to the plane of the crack.
k : float
    Stress intensity factor.</p>
<h2>Returns</h2>
<p>sig_x : array
    Diagonal component of stress tensor parallel to the plane of the
    crack.
sig_y : array
    Diagonal component of stress tensor normal to the plane of the
    crack.
sig_xy : array
    Off-diagonal component of the stress tensor.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.stresses', this);">Show source &equiv;</a></p>
  <div id="source-matscipy.fracture_mechanics.crack.RectilinearAnisotropicCrack.stresses" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stress field in mode I fracture. Positions are passed in cylinder</span>
<span class="sd">    coordinates.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r : array_like</span>
<span class="sd">        Distances from the crack tip.</span>
<span class="sd">    theta : array_like</span>
<span class="sd">        Angles with respect to the plane of the crack.</span>
<span class="sd">    k : float</span>
<span class="sd">        Stress intensity factor.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sig_x : array</span>
<span class="sd">        Diagonal component of stress tensor parallel to the plane of the</span>
<span class="sd">        crack.</span>
<span class="sd">    sig_y : array</span>
<span class="sd">        Diagonal component of stress tensor normal to the plane of the</span>
<span class="sd">        crack.</span>
<span class="sd">    sig_xy : array</span>
<span class="sd">        Off-diagonal component of the stress tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">sig_x</span>  <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
    <span class="n">sig_y</span>  <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_mu1_mu2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu1</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu2</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
    <span class="n">sig_xy</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">h2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">h3</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
    <span class="k">return</span> <span class="n">sig_x</span><span class="p">,</span> <span class="n">sig_y</span><span class="p">,</span> <span class="n">sig_xy</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
